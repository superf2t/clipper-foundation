<div>
  <style type="text/css">
    .__tc-modal {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      width: 300px;
      padding: 10px;
      background-color: #FFFFFF;
      font-family: 'Arial', 'sans-serif';
      font-size: 11pt;
      font-weight: normal;
      opacity: 0.9;
      border-radius: 5px;
    }
    .__tc-title {
      font-weight: bold;
      font-size: 12pt;
      color: #3b97d3;
      padding: 10px;
    }
    .__tc-modal a {
      color: #3b97d3;
    }
    .__tc-clip-result, #__tc-change-trip-plan-confirmation, #__tc-new-trip-plan-confirmation {
      padding: 10px;
    }
    .__tc-active-trip-plan-chooser {
      padding: 25px 10px 10px 10px;
    }
    .__tc-select-prompt {
      margin-bottom: 5px;
    }
    .__tc-submit-btn {
      background-color: #3b97d3;
      color: #FFFFFF;
      border-color: #2D73A0;
      display: inline-block;
      margin-top: 5px;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 4px 6px;
      line-height: 1.42857143;
      border-radius: 4px;
      overflow: visible;
    }
    .__tc-checkmark {
      fill: green;
      float: left;
    }
    .__tc-confirmation-text {
      margin-left: 50px;
    }
  </style>
  <script>
    (function($) {
      var ns = window['__tch'];

      var shouldUndoWhenChangingMaps = {% if will_undo_if_user_changes_trip_plan %}true{% else %}false{% endif %};

      function selectTripPlan() {
        var selectElem = $('#__tc-trip-plans')[0];
        var tripPlanId = selectElem[selectElem.selectedIndex].value;
        var url = '{{base_url}}/make_active_and_reclip/' + tripPlanId
          + '?url=' + escape(window.location.href);
        if (shouldUndoWhenChangingMaps) {
          url += '&undo=1';
        }
        var popup = window.open(url);
        popup.onunload = function() {
          if (tripPlanId == '0') {
            $('.__tc-hide-after-submit').hide();
            $('#__tc-change-trip-plan-confirmation').hide();
            $('#__tc-new-trip-plan-confirmation').show();
          } else {
            $('.__tc-hide-after-submit').hide();
            $('#__tc-new-trip-plan-confirmation').hide();
            var tripPlanName = $(selectElem[selectElem.selectedIndex]).attr('tc:trip-plan-name');
            $('#__tc-change-trip-plan-confirmation').show();
            $('#__tc-active-trip-plan-confirmation-plan-name').html(tripPlanName);
          }
        }
      }

      window['__tcSelectTripPlan'] = selectTripPlan;
    })(window['__tc$']);
  </script>
  <div class="__tc-modal">
    <div class="__tc-title">Travel Clipper</div>
    {% if clip_result.status == clip_result.STATUS_SUCCESS_KNOWN_SOURCE %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        <div class="__tc-checkmark">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 95.453 100" enable-background="new 0 0 95.453 100" xml:space="preserve">
          <g>
            <g>
              <polygon points="94.587,27.48 31.657,86.15 31.217,85.68 18.847,72.41 0.566,52.81 14.106,40.19 32.387,59.79 81.776,13.74   "/>
            </g>
          </g>
          </svg>
        </div>
        <div class="__tc-confirmation-text">
          Successfully clipped <b>{{clip_result.entity.name}}</b> to
          <a href="{{clip_result.trip_plan.trip_plan_url()}}" target="_blank">
            {{clip_result.trip_plan.name}}
          </a>
        </div>
      </div>
    {% elif clip_result.status == clip_result.STATUS_SAVED_FOR_LATER %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        We don't recognize this website so we've saved this URL for you to clip manually.
        Visit <a href="{{base_url}}">TravelClipper</a> when you're done clipping.
      </div>
    {% elif clip_result.status == clip_result.STATUS_ALREADY_CLIPPED_URL %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        <b>You've already clipped this page to your trip plan
          <a href="{{clip_result.trip_plan.trip_plan_url()}}" target="_blank">
            {{clip_result.trip_plan.name}}</a>.
        </b>
      </div>
    {% elif clip_result.status == clip_result.STATUS_NO_TRIP_PLAN_FOUND %}
      <div class="__tc-clip-result __tc-hide-after-submit">We couldn't find a trip plan.</div>
    {% elif clip_result.status == clip_result.STATUS_UNDO_SUCCESS %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        Successfully removed <b>{{clip_result.entity.name}}</b> from
        <a href="{{clip_result.trip_plan.trip_plan_url()}}" target="_blank">
          {{clip_result.trip_plan.name}}
        </a>
      </div>
    {% else %}
      <div class="__tc-clip-result __tc-hide-after-submit">An error occurred during clipping.  Please try again.</div>
    {% endif %}
    {% if clip_result.trip_plan %}
      <div class="__tc-active-trip-plan-chooser __tc-hide-after-submit">
        <div>
          <div class="__tc-select-prompt">
            Did you want this clipped to a different trip plan instead?
          </div>
          <select id="__tc-trip-plans">
            {% for trip_plan in all_trip_plans %}
            <option value="{{trip_plan.trip_plan_id}}"
              tc:trip-plan-name="{{trip_plan.name}}"
              {% if trip_plan.trip_plan_id == clip_result.trip_plan.trip_plan_id %}
              selected="1"
              {% endif %}
              >
              {{trip_plan.name}}
            </option>
            {% endfor %}
            <option value="0">Create new trip plan</option>
          </select>
        </div>
        <div>
          <a href="javascript:void(0)">
            <div class="__tc-submit-btn" onclick="__tcSelectTripPlan()">
              Change
            </div>
          </a>
        </div>
      </div>
      <div id="__tc-change-trip-plan-confirmation" style="display:none">
        <b>Your clips will now be saved to the trip plan
        <a href="{{base_url}}/trip_plan" target="_blank" id="__tc-active-trip-plan-confirmation-plan-name"></a></b>
        <br/>
        <br/>
        <div>
          {% if will_undo_if_user_changes_trip_plan %}
            The item <b>{{clip_result.entity.name}}</b> has been moved there as well.
          {% else %}
            The item <b>{{clip_result.entity.name}}</b> has been clipped there as well.
          {% endif %}
        </div>
      </div>
      <div id="__tc-new-trip-plan-confirmation" style="display:none">
        <b>
          Your new trip plan has been created.
          Click <a href="{{base_url}}/trip_plan" target="_blank">here</a> to view and edit.
        </b>
        <br/>
        <br/>
        <div>
          {% if will_undo_if_user_changes_trip_plan %}
            The item <b>{{clip_result.entity.name}}</b> has been moved there as well.
          {% else %}
            The item <b>{{clip_result.entity.name}}</b> has been clipped there as well.
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
</div>
