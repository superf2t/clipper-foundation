<div>
  <style type="text/css">
    .__tc-modal {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      width: 300px;
      padding: 10px;
      background-color: #FFFFFF;
      font-family: 'Arial', 'sans-serif';
      font-size: 11pt;
      font-weight: normal;
      opacity: 0.9;
      border-radius: 5px;
    }
    .__tc-title {
      font-weight: bold;
      font-size: 12pt;
      color: #3b97d3;
      padding: 10px;
    }
    .__tc-clip-result, #__tc-change-trip-plan-confirmation, #__tc-new-trip-plan-confirmation {
      padding: 10px;
    }
    .__tc-inline-trip-plan-name {
      font-style: bold;
    }
    .__tc-active-trip-plan-chooser {
      padding: 10px;
    }
    .__tc-select-prompt {
      margin-bottom: 5px;
    }
    .__tc-submit-btn {
      position: relative;
      left: 220px;
      top: -25px;
      background-color: #3b97d3;
      color: #FFFFFF;
      border-color: #2D73A0;
      display: inline-block;
      margin-bottom: 0;
      font-weight: 400;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      background-image: none;
      border: 1px solid transparent;
      white-space: nowrap;
      padding: 4px 6px;
      line-height: 1.42857143;
      border-radius: 4px;
      overflow: visible;
    }
  </style>
  <script>
    (function($) {
      var ns = window['__tch'];

      function selectTripPlan() {
        var selectElem = $('#__tc-trip-plans')[0];
        var tripPlanId = selectElem[selectElem.selectedIndex].value;
        var url = '{{base_url}}/make_active/' + tripPlanId;
        var popup = window.open(url);
        popup.onunload = function() {
          if (tripPlanId == '0') {
            $('.__tc-hide-after-submit').hide();
            $('#__tc-change-trip-plan-confirmation').hide();
            $('#__tc-new-trip-plan-confirmation').show();
          } else {
            $('.__tc-hide-after-submit').hide();
            $('#__tc-new-trip-plan-confirmation').hide();
            var tripPlanName = $(selectElem[selectElem.selectedIndex]).attr('tc:trip-plan-name');
            $('#__tc-change-trip-plan-confirmation').show();
            $('#__tc-active-trip-plan-confirmation-plan-name').html(tripPlanName);
          }
        }
      }

      function undo() {
        ns.undoClip(location.href, function() {
          $('.__tc-hide-after-undo').hide();
        });
      }

      window['__tcSelectTripPlan'] = selectTripPlan;
      window['__tcUndo'] = undo;
    })(window['__tc$']);
  </script>
  <div class="__tc-modal">
    <div class="__tc-title">Travel Clipper</div>
    {% if clip_result.status == clip_result.STATUS_SUCCESS_KNOWN_SOURCE %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        Successfully clipped "{{clip_result.entity.name}}" to
        <span class="__tc-inline-trip-plan-name">
          <a href="{{clip_result.trip_plan.trip_plan_url()}}" target="_blank">{{clip_result.trip_plan.name}}</a>
        </span>
        <br/>
        <br/>
        Made a mistake?
        <a href="javascript:void(0)"
          onclick="__tcUndo()">
          Undo
        </a>
      </div>
    {% elif clip_result.status == clip_result.STATUS_SAVED_FOR_LATER %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        We don't recognize this website so we've saved this URL for you to clip manually.  Visit <a href="{{base_url}}">TravelClipper</a> when you're done clipping.
      </div>
    {% elif clip_result.status == clip_result.STATUS_ALREADY_CLIPPED_URL %}
      <div class="__tc-clip-result __tc-hide-after-submit">You've already clipped this page to your trip plan.</div>
    {% elif clip_result.status == clip_result.STATUS_NO_TRIP_PLAN_FOUND %}
      <div class="__tc-clip-result __tc-hide-after-submit">We couldn't find a trip plan.</div>
    {% elif clip_result.status == clip_result.STATUS_UNDO_SUCCESS %}
      <div class="__tc-clip-result __tc-hide-after-submit">
        Successfully removed "{{clip_result.entity.name}}" from
        <span class="__tc-inline-trip-plan-name">
          <a href="{{clip_result.trip_plan.trip_plan_url()}}" target="_blank">{{clip_result.trip_plan.name}}</a>
        </span>
      </div>
    {% else %}
      <div class="__tc-clip-result __tc-hide-after-submit">An error occurred during clipping.  Please try again.</div>
    {% endif %}
    {% if clip_result.trip_plan %}
      <div class="__tc-active-trip-plan-chooser __tc-hide-after-submit __tc-hide-after-undo">
        <div>
          <div class="__tc-select-prompt">
            Select a different trip plan?
          </div>
          <select id="__tc-trip-plans">
            {% for trip_plan in all_trip_plans %}
            <option value="{{trip_plan.trip_plan_id}}"
              tc:trip-plan-name="{{trip_plan.name}}"
              {% if trip_plan.trip_plan_id == clip_result.trip_plan.trip_plan_id %}
              selected="1"
              {% endif %}
              >
              {{trip_plan.name}}
            </option>
            {% endfor %}
            <option value="0">Create new trip plan</option>
          </select>
        </div>
        <a href="javascript:void(0)">
          <div class="__tc-submit-btn" onclick="__tcSelectTripPlan()">
            Change
          </div>
        </a>
      </div>
      <div id="__tc-change-trip-plan-confirmation" style="display:none">
        Your clips will now be saved to the trip plan:
        "<span id="__tc-active-trip-plan-confirmation-plan-name"></span>"
      </div>
      <div id="__tc-new-trip-plan-confirmation" style="display:none">
        Your new trip plan has been created.
        Visit <a href="{{base_url}}/trip_plan" target="_blank">{{base_url}}/trip_plan</a>
        to view and edit.
      </div>
    {% endif %}
  </div>
</div>
