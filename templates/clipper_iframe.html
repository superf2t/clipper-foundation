<!doctype html>
<html>
<head>
  <title>Travel Clipper</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
  <!--<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>-->
  <script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
  <script src="/static/js/ui-bootstrap-tpls-0.10.9.js"></script>
  <script src="/static/js/services.js"></script>
  <script src="/static/js/script.js"></script>
  <script src="/static/js/clipper.js"></script>
  <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400|Raleway:400|Nunito:300">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/shared.css">
  <link rel="stylesheet" href="/static/css/clipper.css">
  <link rel="shortcut icon" href="/static/img/globe.png">
</head>
<body ng-controller="ClipperRootCtrl" class="clipper-body">

  <div ng-if="clipperState.status == ClipperState.SUMMARY"
    class="summary-panel"
    tc-watch-for-overflow class-when-overflowing="has-overflow"
    watch-expr="displayState.dirtyCounter">
    <div class="upper-panel">
      <div class="intro-text">
        <span ng-if="entityModels.length > 1">
          We found the following [[entityModels.length]] places:
        </span>
        <span ng-if="entityModels.length == 1">
          We found the following place:
        </span>
      </div>

      <div class="entity-results">
        <div ng-if="entityModels.length > 1" ng-include="'select-all-checkbox-row-template'">
        </div>
        <div ng-repeat="entityModel in entityModels" tc-entity-result
          show-checkboxes="entityModels.length > 1" entity-data="entityModel.data"
          click-to-select="false" editable="true" in-iframe="true"
          display-state="displayState"
          active-trip-plan="selectedTripPlanState.tripPlan">
        </div>

        <div class="missing-add-place blue-links">
          Missing a place?
          <a ng-click="startManualEntry()" href="javascript:void(0)">Click to add</a>
        </div>
      </div>
    </div>

    <div class="save-to-trip-plan-panel">
      <div class="save-prompt-text">
        <span ng-if="entityModels.length > 1">
          Save [[selectedEntities().length]] selected places to a trip
        </span>
        <span ng-if="entityModels.length == 1">
          Save [[entityModels[0].data['name'] ]] to a trip
        </span>
      </div>
      <div tc-trip-plan-select-dropdown
        select-trip-plan-to="selectedTripPlanState.tripPlan"
        class="trip-plan-dropdown">
      </div> 
      <div class="save-button">
        <button class="btn btn-primary" ng-click="saveEntities()"
          ng-disabled="!saveButtonEnabled()">
          Save to trip
        </button>
      </div>
    </div>
  </div>

  <div ng-if="clipperState.status == ClipperState.NO_AUTO_PLACE_FOUND">
    <div class="upper-panel">
      <div class="intro-text">
        <span ng-if="entityModels.length == 0">
          Uh oh, we couldn't find the place(s) on this page.
          <br/>
          Help us help you by tagging this page with a place.
        </span>
      </div>
    </div>
    <div class="omnibox-panel" ng-controller="ClipperOmniboxCtrl">
      <div class="search-prompt-text">Search</div>
      <input class="form-control" ng-model="rawInputText" placeholder="Search for a place name or address"
            tc-google-place-autocomplete search-bounds-json="selectedTripPlanState.tripPlan['location_bounds']"
            on-place-change="placeChanged($newPlace)"/>
      <div ng-show="loadingData" class="search-spinner">
        <img src="/static/img/spinner-small.gif"/>
      </div>
      <div class="search-results" ng-show="searchResults">
        <div ng-repeat="result in searchResults" class="one-result" ng-click="selectResult(result)">
          <img ng-src="[[result['icon'] ]]" class="result-icon"/>
          [[result['name'] ]]
          <span class="result-address">[[result['formatted_address'] ]]</span>
        </div>
      </div>
    </div>
    <div class="enter-manually-link">
      <a ng-click="startManualEntry()" href="javascript:void(0)">
        Or enter place manually
      </a>
    </div>
  </div>

  <div ng-if="clipperState.status == ClipperState.SUCCESS_CONFIRMATION" class="clip-success">
    <div class="checkmark">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 95.453 100" enable-background="new 0 0 95.453 100" xml:space="preserve">
      <g>
        <g>
          <polygon points="94.587,27.48 31.657,86.15 31.217,85.68 18.847,72.41 0.566,52.81 14.106,40.19 32.387,59.79 81.776,13.74"/>
        </g>
      </g>
      </svg>
    </div>
    <div>
      <span ng-if="savedEntities.length == 1">
        Successfully clipped [[savedEntities[0]['name'] ]] to
      </span>
      <span ng-if="savedEntities.length > 1">
        Successfully clipped [[savedEntities.length]] places to
      </span>
    </div>
    <div class="trip-plan-name">
      <a href="/trip_plan/[[selectedTripPlanState.tripPlan['trip_plan_id'] ]]" target="_blank">
        [[selectedTripPlanState.tripPlan['name'] ]]
      </a>
    </div>
  </div>

  <div ng-if="clipperState.status == ClipperState.WAITING_FOR_SCRAPE_FROM_PAGE_SOURCE"
    class="full-spinner">
  </div>

  <script type="text/ng-template" id="select-all-checkbox-row-template">
    <div class="select-all-checkbox-row">
      <div class="checkbox-container">
        <div ng-click="toggleSelectAll()" class="entity-checkbox">
          <span class="glyphicon glyphicon-check" ng-show="allEntitiesSelected()"></span>
          <span class="glyphicon glyphicon-unchecked" ng-show="!allEntitiesSelected()"></span>
        </div>
      </div>
    </div>
  </script>

  {% include 'entity-result.html' %}
  {% include 'widgets.html' %}

  <script>
    initClipper(
      {{entities_json|safe}},
      {{needs_client_page_source|jsbool}},
      {{all_trip_plans_json|safe}},
      {{all_datatype_values.to_json_str()|safe}});
  </script>
</body>
</html>
