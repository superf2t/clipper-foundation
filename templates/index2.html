<!doctype html>
<html>
<head>
  <title>WhereFare</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
  <script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
  <script src="/static/js/ui-bootstrap-tpls-0.11.0.min.js"></script>
  <script src="/static/js/services.js"></script>
  <script src="/static/js/script.js"></script>
  <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:300">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="shortcut icon" href="/static/img/globe-bw.png">
  {% set analytics_page_type = 'home' %}
  {% include 'analytics.html' %}

  <meta name="google-site-verification" content="exwLtl2j5oJDCsWkznGHaxKH9EcY1Bw9K2-_7YO4QUA" />

  <style type="text/css">

    html, body {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
      font-family: 'Avenir', Helvetica, Arial, sans-serif;
      overflow-x: hidden;
    }

    a:hover {
      text-decoration: none;
    }

    a.white-link {
      color: #FFFFFF;
    }

    a.white-link:hover {
      color: #FFFFFF;
    }

    .section-header {
      padding: 30px 0px;
      text-align: center;
      font-size: 1.0em;
      font-weight: 600;
    }

    .md-text {
      font-size: 1.3em;
    }

    .lg-text {
      font-size: 1.8em;
    }

    .splash-section {
      background: url('https://lh6.googleusercontent.com/-wZw7xlTPEuc/UspHwEf-ZlI/AAAAAAAAmKQ/FrRzhz_a898/w1285-h848-no/IMG_2489_90_91.jpg') 50% 10%
        no-repeat fixed;
      background-size: cover;
      min-height: 75%;
      height: 75%;
      margin: 0 auto;
      width: 100%;
      max-width: 1920px;
      position: relative;
    }

    .splash-wrapper {
      min-height: 100%;
    }

    .site-header {
      position: absolute;
      top: 0%;
      width: 100%;
    }

    .logo {
      font-family: 'Raleway';
      background-color: #000000;
      padding: 4px 6px;
      color: #FFFFFF;
      font-size: 1.2em;
      line-height: 1.0;
      position: absolute;
      top: 5px;
      left: 5px;
    }

    .login {
      position: absolute;
      top: 5px;
      right: 10px;
      color: #FFFFFF;
    }

    .tagline {
      position: absolute;
      margin: 0 auto;
      text-align: center;
      height: 100px;
      top: 35%;
      width: 100%;
      color: #FFFFFF;      
      font-size: 4.0em;
      line-height: 1.0;
      font-weight: 500;
      text-shadow: 1px 1px 6px #777;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .sub-tagline {
      position: absolute;
      margin: 0 auto;
      text-align: center;
      top: 50%;
      height: 50px;
      width: 100%;
      color: #FFFFFF;
      font-size: 1.7em;
      text-shadow: 1px 1px 6px #777;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .search-input-wrapper {
      width: 100%;
      position: absolute;
      bottom: 0;
      padding: 20px 0px;
      margin: auto;
      background-color: rgba(0, 0, 0, 0.80);
    }

    .search-input-section {
      width: 600px;
      margin: auto;
    }

    @media (max-width: 600px) {
      .tagline {
        top: 25%;
      }
      .sub-tagline {
        top: 60%;
      }
      .search-input-section {
        width: 360px;
      }  
    }

    .learn-more-section {
      background: url('/static/img/index/bg-map.jpg') 50% 50%
        no-repeat;
      background-color: #FFFFFF;
    }

    .learn-more-wrapper {
      background-color: rgba(255,255,255,0.7);
      min-height: 100%;
      width: 100%;
      padding: 30px 0px 20px 0px;
    }

    .learn-more-container {
      padding: 20px 0px 0px 0px;
    }

    .learn-more-text {
      position: relative;
      bottom: 70px;
      left: 120px;
    }

    .learn-more-section #step-1 {
      color: #3498db;      
    }

    .learn-more-section #step-1 svg {
      fill: #3498db;      
    }

    .learn-more-section #step-2 {
      color: #8e44ad;      
    }

    .learn-more-section #step-2 svg {
      fill: #8e44ad;      
    }

    .learn-more-section #step-3 {
      color: #16a085;      
    }    

    .learn-more-section #step-3 svg {
      fill: #16a085;      
    }

    @media (min-width: 768px) and (max-width: 990px) {
      .learn-more-text {
        bottom: 0;
        left: 0;
      }
      .learn-more-step {
        text-align: center;
      }
    }

    .featured-cities-section {
      position: relative;
      margin: 0 auto;
      width: 100%;
      background-color: #FFFFFF;
      z-index: 1;
      padding-bottom: 15px;
      border-top: 1px solid #DDD;   
    }

    .featured-cities-section .city-metadata {
      position: relative;
      top: 220px;
      height: 40px;
      margin-bottom: -40px;
      background-color: rgba(0,0,0,0.5);
      color: #FFFFFF;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .featured-cities-section .city {
      width: 100%;
      height: 260px;
      background-repeat: no-repeat;
      background-position: 50% 50%;
      background-size: cover !important;
      -webkit-background-size: cover !important;
      -moz-background-size: cover !important;
      margin: 0 auto 30px auto;
      -webkit-box-shadow: 0 0 3px rgba(0,0,0,0.3);
      box-shadow: 0 0 3px rgba(0,0,0,0.3);
      border-radius: 2px;
    }

    @media (max-width: 767px) {
      .featured-cities-section .city {
        height: 320px;
      }
      .featured-cities-section .city-metadata {
        top: 280px;
      }
    }

    @media (min-width: 768px) and (max-width: 1200px) {
      .featured-cities-section .city {
        height: 240px;
      }
      .featured-cities-section .city-metadata {
        top: 200px;
      }      
    }

    @media (min-width: 1441px) {
      .featured-cities-section .city {
        height: 300px;
      }
      .featured-cities-section .city-metadata {
        top: 260px;
      }
    }

    .featured-cities-section .city-name {
      float: left;
      font-size: 1.4em;
      font-weight: 500;
      padding: 6px 10px;
    }

    .featured-cities-section .city-guides-number {
      float: right;
      font-size: 1.1em;
      font-weight: 500;
      padding: 10px;    
    }

    .featured-cities-section .featured-city:hover .city-metadata {
      background-color: rgba(0,0,0,0.25);
    }

    .search-section {
      background: url('https://lh5.googleusercontent.com/-XFHga-H4op4/UspHQuuPT3I/AAAAAAAAmKQ/tX5v3FY1kwk/w1272-h848-no/IMG_3144.jpg') 50% 0px repeat fixed;
      width: 100%;
      max-width: 1920px;
      min-height: 400px;
      height: 400px;
      background-size: cover;
      position: relative;
    }

    .search-section .section-header {
      color: #FFFFFF;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .search-input-section .search-input {
      height: 46px;
      font-size: 1.1em;
    }

    .search-input-section .btn-search {
      color: #FFFFFF;
      height: 46px;
      background-color: #4A90E2;
      padding: 6px 20px;
    }

    .search-results {
      background-color: #FFFFFF;
      max-height: 175px;
      overflow-y: scroll;
    }

    .one-search-result {
      padding: 10px;
      cursor: pointer;
    }

    .one-search-result:hover {
      color: #D0021B;
    }

    .result-icon {
      max-width: 24px;
    }

    .featured-sources-section {
      position: relative;
      width: 100%;
      background-color: #EEE;
      text-align: center;
      -webkit-box-shadow: 0 0 10px rgba(0,0,0,0.3);
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 2;
      padding-bottom: 15px;
    }

    .featured-source .source {
      width: 100%;
      max-width: 200px;
      height: 160px;
      background-repeat: no-repeat;
      background-position: 50% 50%;
      background-size: cover !important;
      -webkit-background-size: cover !important;
      -moz-background-size: cover !important;
      margin: 0 auto 30px auto;
      border-radius: 2px;
    }

    .more-cities-section {
      background: url('https://lh4.googleusercontent.com/-4hnsKTgPsTo/UspJ9d5jTvI/AAAAAAAAmKQ/C3LqRLrMLVI/w1274-h848-no/IMG_1405.jpg') 50% 0px repeat fixed;
      width: 100%;
      max-width: 1920px;
      min-height: 600px;
      height: 600px;
      background-size: cover;
      position: relative;
      color: #FFFFFF;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a.city-link {
      color: #FFFFFF;
      font-size: 1.2em;
    }

    a.city-link:hover {
      color: #FFFFFF;
      font-weight: 500;
    }

    #bottom-search-input-section {
      margin-top: 70px;
    }

    .footer-section {
      position: relative;
      width: 100%;
      z-index: 3;
      text-align: center;
      -webkit-box-shadow: 0 0 10px rgba(0,0,0,0.3);
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      height: 200px;
      background-color: #FFFFFF;
      text-align: center;
    }

    .copyright {
      position: relative;
      height: 16px;
      top: calc(50% - 8px);
      color: #777;
      font-size: 1.1em;
    }

    @media (max-width: 768px) {
      .more-cities-section {
        height: 1000px;
      }
      .featured-source .source {
        height: 180px;
      }
    }

    @media (min-width: 769px) and (max-width: 990px) {
      .more-cities-section {
        height: 700px;
      }
      .featured-source .source {
        height: 200px;
      }
    }

    @media (min-width: 991px) and (max-width: 1200px) {
      .featured-source .source {
        height: 130px;
      }
    }

    @media (max-width: 1200px) {
      .search-section {
        background: url('https://lh5.googleusercontent.com/-XFHga-H4op4/UspHQuuPT3I/AAAAAAAAmKQ/tX5v3FY1kwk/w1272-h848-no/IMG_3144.jpg') 50% 0px repeat fixed;
        height: 300px;
      }
    }

    @media (max-width: 980px) {
      .splash-section, .more-cities-section, .search-section {
        background-attachment: scroll;
      }
    }
    
  </style>

  <script>
    function IndexCtrl($scope, $flashedMessages, $eventTracker, $http, $window) {
      var me = this;
      $scope.flashedMessages = $flashedMessages;
      $scope.searchState = {
        rawInput: null,
        // Prevent double-submits
        searchInProgress: false
      };

      {# TODO: Much of this functionality is copied from StartNewTripInputCtrl,
        figure out how to share this instead. #}

      $scope.placeChanged = function($place) {
        if (!$place || $scope.searchState.searchInProgress) {
          return;
        }
        $scope.searchState.searchInProgress = true;
        if (!$place['geometry']) {
          return me.searchForPlace($place['name']);
        }
        $scope.selectResult($place);
        $eventTracker.track({name: 'new-trip-location-autocomplete',
          location: 'homepage', value: $place['name']});
      };

      $scope.searchButtonClicked = function() {
        if ($scope.searchState.rawInput) {
          me.searchForPlace($scope.searchState.rawInput);
        }
      };

      $scope.selectResult = function(place) {
        var tripPlanDetails = me.placeToTripPlanDetails(place);
        me.saveNewTripPlan(tripPlanDetails)
          .success(function(response) {
            var tripPlanId = response['trip_plans'][0]['trip_plan_id'];
            $scope.searchState.searchInProgress = false;
            $window.location.href = '/guide/' + tripPlanId;
          });
        $eventTracker.track({name: 'new-trip-location-result-selected',
          location: 'homepage', value: place['name']});
      };

      this.searchForPlace = function(query) {
        $scope.searchResults = null;
        $scope.searching = true;
        var request = {
          query: query
        };
        var dummyMap = new google.maps.Map($('<div>')[0], {
          center: new google.maps.LatLng(0, 0)
        });
        var searchService = new google.maps.places.PlacesService(dummyMap);
        searchService.textSearch(request, function(results, status) {
          $scope.$apply(function() {
            $scope.searching = false;
            if (status != google.maps.places.PlacesServiceStatus.OK) {
              alert('Search failed, please try again.');
              return;
            }
            $.each(results, function(i, result) {
              if (result['icon'].indexOf('geocode') >= 0) {
                result['icon'] = '/static/img/place-proximity.svg';
              }
            });
            $scope.searchResults = results;
          $scope.searchState.searchInProgress = false;
          });
        });
        $eventTracker.track({name: 'new-trip-location-search',
          location: 'homepage', value: query});
      };

      this.placeToTripPlanDetails = function(place) {
        var geometry = place['geometry'];
        var location = geometry && geometry['location'];
        var viewport = geometry && geometry['viewport'];
        var tripPlanDetails = {
          'name': place['name'],
          'location_name': place['formatted_address']
        };
        if (location) {
          tripPlanDetails['location_latlng'] = {
            'lat': location.lat(),
            'lng': location.lng()
          };
        }
        if (viewport) {
          tripPlanDetails['location_bounds'] = {
            'southwest': {
              'lat': viewport.getSouthWest().lat(),
              'lng': viewport.getSouthWest().lng()
            },
            'northeast': {
              'lat': viewport.getNorthEast().lat(),
              'lng': viewport.getNorthEast().lng()
            }
          }
        }
        return tripPlanDetails;
      };

      this.saveNewTripPlan = function(tripPlanDetails) {
        var request = {
          'operations': [{
            'operator': 'ADD',
            'trip_plan': tripPlanDetails
          }]
        };
        return $http.post('/tripplanservice/mutate', request)
      };
    }

    window['initIndexApp'] = function(flashedMessages) {
      angular.module('indexAppModule', ['navModule'], interpolator)
        .controller('IndexCtrl', IndexCtrl)
        .directive('tcGooglePlaceAutocomplete', tcGooglePlaceAutocomplete)
        .directive('tcTripPlanDetailsHeader', tcTripPlanDetailsHeader)
        .value('$flashedMessages', flashedMessages);

      angular.element(document).ready(function() {
        angular.bootstrap(document, ['indexAppModule']);
      });      
    }
  </script>
</head>
<body ng-controller="IndexCtrl">

  <tc-flashed-messages messages="flashedMessages">
  </tc-flashed-messages>

  <div class="splash-section">
    <div class="splash-wrapper">
      <div class="site-header">
        <div class="logo">
          WhereFare
        </div>
        <div class="login">
          {% if account_info.logged_in %}
          <a class="white-link" href="/profile/{{account_info.user.public_id}}">
            My Trips
          </a>
          {% else %}
          <a class="white-link" href="{{url_for('user.register', next='/')}}">
            Join
          </a>
          |
          <a class="white-link" href="{{url_for('user.login', next='/guide')}}">
            Log In
          </a>
          {% endif %}
        </div>
      </div>
      <div class="tagline">
        Your Own Travel Guide
      </div>
      <div class="sub-tagline">
        Build a personalized map in minutes
      </div>      
      <div class="search-input-wrapper">
        <div class="search-input-section">
          <div class="input-group">
            <input type="text" class="form-control search-input" id="main-input"
              ng-model="searchState.rawInput"
              placeholder="Where are you going?"
              tc-google-place-autocomplete on-place-change="placeChanged($newPlace)">
            <span class="input-group-btn">
              <button class="btn btn-search" type="button" ng-click="searchButtonClicked()">
                New Guide
              </button>
            </span>
          </div>
          <div ng-include="'search-results-template'">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="learn-more-section">
    <div class="learn-more-wrapper">
      <div class="learn-more-container container">
        <div class="learn-more-steps row">
          <div class="learn-more-step col-md-4 col-sm-4 col-xs-12" id="step-1">
            <div ng-include="'place-icon-template'" class="learn-more-icon">
            </div>
            <div class="md-text learn-more-text">
              Pick a city or region
            </div>
          </div>
          <div class="learn-more-step col-md-4 col-sm-4 col-xs-12" id="step-2">
            <div ng-include="'add-icon-template'" class="learn-more-icon">
            </div>
            <div class="md-text learn-more-text">
              Find and add places
            </div>
          </div>
          <div class="learn-more-step col-md-4 col-sm-4 col-xs-12" id="step-3">
            <div ng-include="'phone-icon-template'" class="learn-more-icon">
            </div>
            <div class="md-text learn-more-text">
              Take your guide with you
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="featured-cities-section">
    <div class="section-header">
      <span class="lg-text">FEATURED DESTINATIONS</span>
    </div>
    <div class="cities-container container">
      <div class="featured-cities row">
        {% for config in featured_guide_configs %}
        <a href="/guides/{{config.city_name_url_token}}">
          <div class="featured-city col-md-4 col-sm-6 col-xs-12">
            <div class="city"
              style="background-image: url(&quot;/static/img/index/{{config.city_name_url_token}}.jpg&quot;);">
              <div class="city-metadata">
                <span class="city-name">
                  {{config.city_name}}
                </span>
                <span class="city-guides-number">
                  {{config.trip_plan_ids | length}} Guides
                </span>
              </div>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="more-cities-section">
    <div class="section-header">
      <span class="lg-text">ALL DESTINATIONS</span>
    </div>
    <div class="more-cities-container container">
      <div class="more-cities row">
        {% for config in all_guide_configs %}
        <a class="city-link" href="/guides/{{config.city_name_url_token}}">
          <div class="col-md-3 col-sm-4 col-xs-6">
            {{config.city_name}}
          </div>
        </a>
        {% endfor %}
      </div>
    </div>    
  </div>

  <div class="featured-sources-section">
    <div class="section-header">
      <span class="lg-text">FEATURED SOURCES</span>
    </div>
    <div class="sources-container container">
      <div class="top-sources row">
        {% for config in featured_profile_configs %}
        <a href="/profile/{{config.profile_name_token}}">
          <div class="featured-source col-md-2 col-sm-4 col-xs-6">
            <div class="source"
              style="background-image: url(&quot;{{config.icon_url}}&quot;);">
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="search-section">
    <div class="section-header">
      <span class="lg-text">GET STARTED NOW</span>
    </div>
    <div class="search-input-section" id="bottom-search-input-section">
      <div class="input-group">
        <input type="text" class="form-control search-input" id="main-input"
          ng-model="searchState.rawInput"
          placeholder="Where are you going?"
          tc-google-place-autocomplete on-place-change="placeChanged($newPlace)">
        <span class="input-group-btn">
          <button class="btn btn-search" type="button" ng-click="searchButtonClicked()">
            New Guide
          </button>
        </span>
      </div>
      <div ng-include="'search-results-template'">
      </div>
    </div>
  </div>

  <div class="footer-section">
    <div class="copyright">
      © WhereFare. All rights reserved.
    </div>
  </div>

  <script type="text/ng-template" id="search-results-template">
    <div class="search-results" ng-if="searchResults && searchResults.length">
      <div ng-repeat="result in searchResults" class="one-search-result" ng-click="selectResult(result)">
        <img ng-src="[[result['icon'] ]]" class="result-icon"/>
        [[result['formatted_address'] ]]
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="place-icon-template">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Ebene_1" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
    <g>
      <path d="M87.5,36.172c0-20.014-16.785-36.24-37.5-36.24c-20.709,0-37.5,16.226-37.5,36.24c0,37.002,37.5,63.76,37.5,63.76   S87.5,73.175,87.5,36.172z M50,54.52c-10.309,0-18.665-8.072-18.665-18.039c0-9.964,8.356-18.039,18.665-18.039   s18.652,8.075,18.652,18.039C68.652,46.447,60.309,54.52,50,54.52z"/>
    </g>
    </svg>
  </script>

  <script type="text/ng-template" id="add-icon-template">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Your_Icon" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve">
    <g>
      <path d="M50.006,0C22.435,0,0,22.435,0,49.994C0,77.565,22.435,100,50.006,100C77.565,100,100,77.565,100,49.994   C100,22.435,77.565,0,50.006,0z M50.006,90.725c-22.458,0-40.73-18.272-40.73-40.73c0-22.446,18.272-40.719,40.73-40.719   c22.446,0,40.719,18.272,40.719,40.719C90.725,72.452,72.452,90.725,50.006,90.725z"/>
    </g>
    <g>
      <path d="M71.154,49.994c0,2.562-2.075,4.638-4.638,4.638H54.643v11.896c0,2.551-2.087,4.638-4.638,4.638   c-2.562,0-4.638-2.087-4.638-4.638V54.632H33.472c-2.551,0-4.638-2.075-4.638-4.638c0-2.551,2.087-4.638,4.638-4.638h11.896V33.484   c0-2.562,2.075-4.638,4.638-4.638c2.551,0,4.638,2.075,4.638,4.638v11.872h11.872C69.078,45.357,71.154,47.443,71.154,49.994z"/>
    </g>
    </svg>
  </script>

  <script type="text/ng-template" id="phone-icon-template">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Laag_1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve" height="100px" width="100px">
    <path d="M69.3,0.5h-38c-5.5,0-10,4.5-10,10v78c0,5.5,4.5,10,10,10h38c5.5,0,10-4.5,10-10v-78  C79.3,5,74.8,0.5,69.3,0.5z M50,93.2c-2.7,0-5-2.2-5-5c0-2.7,2.2-5,5-5s5,2.2,5,5C55,91,52.7,93.2,50,93.2z M71.3,79.5h-42v-66h42  V79.5z"/>
    </svg>
  </script>

  {% include 'nav.html' %}

  <script>
    initIndexApp({{to_json_str(flashed_messages) | safe}});
  </script>
</body>
</html>
