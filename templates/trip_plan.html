<!doctype html>
<html>
<head>
  <title>{{plan.name}}</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
  <script src="/static/js/ui-bootstrap-tpls-0.10.9.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script src="/static/js/script.js"></script>
  <link type="text/css" rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body ng-controller="RootCtrl">
  <nav class="navbar navbar-default navbar-fixed-top" id="upper-navbar">
    <div class="upper-nav container">
      <div class="row">
        <div class="col-md-3" id="logo">Travel Clipper</div>
        <div class="col-md-6" id="trip-plan-title">
          <span ng-show="!editingTripPlanSettings">[[editableTripPlanSettings['name'] ]]</span>
          <form class="form-inline" role="form" onsubmit="return false" ng-show="editingTripPlanSettings">
            <input class="form-control" id="trip-plan-title-input" type="text" ng-model="editableTripPlanSettings.name"/>
            <button class="btn btn-save-changes" ng-click="saveTripPlanSettings()">Save</button>
          </form>
          <a href="javascript:void(0)" ng-click="editTripPlanSettings()" ng-show="!editingTripPlanSettings">
            <button type="button" class="btn btn-sm" id="edit-title-btn">
              <span class="glyphicon glyphicon-pencil"></span>
            </button>
          </a>
        </div>
        <div class="col-md-3" id="my-account-link">
          <a href="javascript:void(0)" ng-click="openAccountDropdown()">My Trip Plans</a>
        </div>
      </div>
    </div>
  </nav> 
  <nav class="navbar navbar-fixed-top" id="lower-navbar">
    <div class="lower-nav container" ng-controller="NavigationCtrl">
      <div class="row">
        <div class="entity-nav">
          <a href="javascript:void(0)" ng-scroll-to-on-click="'Hotel'">
            <div class="col-md-1 navigation-link">
              Hotels
            </div>
          </a>
          <a href="javascript:void(0)" ng-scroll-to-on-click="'Restaurant'">
            <div class="col-md-1 navigation-link">
              Restaurants
            </div>
          </a>
          <a href="javascript:void(0)" ng-scroll-to-on-click="'Attraction'">
            <div class="col-md-1 navigation-link">
              Attractions
            </div>
          </a>
        </div>
        <div class="col-md-6" id="url-box">
          <input type="text" class="form-control"
            placeholder="Paste a URL to add to your trip plan"
            ng-model="clipState.url"
            ng-disabled="clipState.clipping"
            ng-paste="clipUrlChanged()"/>
        </div>
        <div class="col-me-3" id="list-map-btns">
          <button type="button" class="btn btn-default btn-sm nav-btn">
            <span class="glyphicon glyphicon-picture"></span>
          </button>
          <button type="button" class="btn btn-default btn-sm nav-btn">
            <span class="glyphicon glyphicon-globe"></span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div id="entity-container">
      <div ng-if="planModel.hasClippedPages()" ng-controller="ClippedPagesCtrl">
        <h3>Clipped Pages</h3>
        <div>
          These are pages you clipped but we're unable to automatically parse.  Click on each to extract locations from the page.
        </div>
        <div ng-repeat="clippedPage in planModel.data['clipped_pages']">
          <a href="javascript:void(0)"
            ng-click="openPageForClipping(clippedPage['source_url'])">
            [[clippedPage['title'] ]]
          </a>
        </div>
        <iframe ng-src="[[clippingPageUrl]]" ng-show="clippingActive" class="clipping-iframe">
        </iframe>
      </div>

    <div ng-repeat="entityType in planModel.ENTITY_TYPES_IN_ORDER">
      <div ng-controller="EntityTypeCtrl">
        <div ng-if="hasEntities()">
          <div class="one-entity-type">
            <a id="[[entityType]]" class="offset-anchor"></a>
            <h3 ng-click="toggleSection()" class="entity-type-header">
              <a href="javascript:void(0)">[[entityType]]s
                <span ng-show="show" class="glyphicon glyphicon-chevron-down toggle-chevron"></span>
                <span ng-show="!show" class="glyphicon glyphicon-chevron-up toggle-chevron"></span>
              </a>
            </h3>
            <div class="columns" ng-show="show">
              <div ng-repeat="entityModel in entityModels">
                <div class="one-entity" ng-mouseenter="openInfowindow(entityModel.data['name'])" ng-controller="EntityCtrl">
                  <div class="one-entity-title">
                    [[entityModel.data['name'] ]]
                  </div>
                  <carousel class="one-entity-carousel" interval="entityModel.carouselInterval">
                    <slide ng-repeat="slide in entityModel.slides" active="slide.active">
                      <span ng-if="slide.active">
                        <img ng-src="[[slide.image]]" class="entity-img">
                      </span>
                    </slide>
                  </carousel>
                  <div class="one-entity-rating">
                    Rating: [[entityModel.data['rating'] ]]
                  </div>
                  <div class="entity-description"
                    ng-show="entityModel.hasDescription() && !editing">
                    <div style="white-space:pre">[[entityModel.data['description'] ]]</div>
                  </div>
                  <div ng-show="editing">
                    <textarea ng-model="entityModel.data['description']" class="form-control entity-description-input"></textarea>
                  </div>
                  <div class="one-entity-source">
                    From <a ng-href="[[entityModel.data['source_url'] ]]" target="_blank">[[entityModel.data['source_url'] | hostname ]]</a>
                  </div>
                  {% if allow_editing %}
                    <div class="entity-edit-controls">
                      <a href="javascript:void(0)"
                        ng-click="deleteEntity()"
                        ng-show="!editing">
                        <span class="glyphicon glyphicon-trash"></span>
                      </a>
                      <a href="javascript:void(0)"
                        ng-click="openEditEntity()"
                        ng-show="!editing">
                        <span class="glyphicon glyphicon-pencil"></span>
                      </a>
                      <button class="btn btn-save-changes" ng-click="saveEntityEdit()" ng-show="editing">Save</button>
                      <a href="javascript:void(0)" ng-click="cancelEditing()" ng-show="editing">
                        Cancel
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="left-footer">
      Copyright 2014 Unicycle Labs
    </div>

  </div>

  <div id="map-container">
    <div id="map">
    </div>
  </div>

  {# This is below the map in the DOM so that it appears visually on top #}
  <div ng-show="accountDropdownOpen">
    <div class="account-dropdown">
      {% for trip_plan in all_trip_plans %}
        <div>
          {# We use a string for the trip plan here because javascript truncates long ints #}
          <a href="javascript:void(0)" ng-click="loadTripPlan('{{trip_plan.trip_plan_id}}')">
            {{trip_plan.name}}
          </a>
        </div>
      {% endfor %}
      <div>
        Create new trip plan
      </div>
    </div>
  </div>

  <script type="text/ng-template" id="clipping-modal-template">
    <div class="clipping-status-modal">
      <div ng-show="clipState.clipping">
        Clipping to your trip plan...
        <div>
          <img src="/static/img/spinner.gif"/>
        </div>
      </div>
      <div ng-show="!clipState.clipping">
        <div ng-if="clipState.statusCode == 0">
          An error occurred during clipping.  Please try again.
        </div>
        <div ng-if="clipState.statusCode == 1">
          Successfully clipped "[[clipState.entity['name'] ]]""
        </div>
        <div ng-if="clipState.statusCode == 2">
          We don't recognize this website so we've saved this URL for you to clip manually.
        </div>
        <div ng-if="clipState.statusCode == 3">
          You've already clipped this page to your trip plan.
        </div>
      </div>
    </div>
  </script>

  <script>
    initApp({{plan.to_json_str()|safe}}, {{plan.settings_json()|safe}});
  </script>
</body>
</html>
