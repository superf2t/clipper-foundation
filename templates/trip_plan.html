<!doctype html>
<html>
<head>
  <title>{{plan.name}}</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
  <script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular-sanitize.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular-animate.min.js"></script>
  <script src="/static/js/ui-bootstrap-tpls-0.11.0.min.js"></script>
  <script src="/static/js/services.js"></script>
  <script src="/static/js/script.js"></script>
  <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:300|Nunito:300,400">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="shortcut icon" href="/static/img/globe.png">
  {% include 'analytics.html' %}
</head>
<body ng-controller="RootCtrl">
  <tc-nav account-info="accountInfo" active-trip-plan="activeTripPlanState.tripPlan"
    num-entities="activeTripPlanState.numEntities" all-trip-plans="allTripPlans"
    shopping-cart-mode="!{{allow_editing | jsbool}}">
  </tc-nav>
  <div tc-include-and-replace="flashed-messages-template"></div>

  <div id="summary-panel" ng-show="{{allow_editing | jsbool}}">
    <div ng-include="'trip-plan-header-template'">
    </div>

    <div id="entity-container"
      ng-class="{'expanded': pageStateModel.summaryPanelExpanded}"
      tc-scroll-to-selector scroll-on-changes-to="pageStateModel.selectedEntity"
      skip-scroll-when-in-view="true"
      scroll-dest-selector=".one-entity-summary[tc-entity-id='[[pageStateModel.selectedEntity['entity_id'] ]]'] .scroll-anchor">
      <div ng-repeat="entity in planModel.entities()">
        <div ng-include="'one-entity-summary-template'">
        </div>
      </div>
    </div>

    {% if needs_tutorial %}
    <div ng-include="'tutorial-left-panel-template'" ng-if="inTutorial()">
    </div>
    {% endif %}
  </div>

  <div id="info-panel" ng-show="!pageStateModel.inNewTripPlanModal"
    ng-class="{'closed': !pageStateModel.infoPanelExpanded}"
    class="closed">
    {% if allow_editing %}
    <div ng-include="'info-panel-nav-template'">
    </div>
    {% endif %}
    <div class="info-panel-content {% if allow_editing %}with-nav{% endif %}">
      <div ng-include="'details-panel-template'"
        class="full-width full-height"
        ng-show="pageStateModel.infoPanelMode == InfoPanelMode.DETAILS">
      </div>
      {% if allow_editing %}
      <div ng-include="'guides-panel-template'"
        class="full-width full-height"
        ng-if="pageStateModel.infoPanelMode == InfoPanelMode.GUIDES">
      </div>
      <div ng-include="'add-your-own-panel-template'"
        class="full-width full-height"
        ng-if="pageStateModel.infoPanelMode == InfoPanelMode.ADD_YOUR_OWN">
      </div>
      <div ng-include="'export-panel-template'"
        class="full-width full-height"
        ng-if="pageStateModel.infoPanelMode == InfoPanelMode.EXPORT">
      </div>
      <div ng-include="'sharing-panel-template'"
        class="full-width full-height"
        ng-if="pageStateModel.infoPanelMode == InfoPanelMode.SHARING">
      </div>
      <div ng-include="'settings-panel-template'"
        class="full-width full-height"
        ng-if="pageStateModel.infoPanelMode == InfoPanelMode.SETTINGS">
      </div>
      {% endif %}
    </div>
  </div>

  <div id="map-panel" tc-animate-on-bool="!pageStateModel.infoPanelExpanded"
    tc-transitionend="updateMap()"
    class-when-true="info-panel-closed" after-complete="updateMap()"
    ng-class="{'full-screen': pageStateModel.isMapFullScreen()}"
    class="info-panel-closed">
    <div id="map-container">
      <div id="map">
      </div>
    </div>
    {% if needs_tutorial %}
    <div ng-include="'tutorial-overlay-template'">
    </div>
    {% endif %}
    <div ng-include="'control-buttons-template'">
    </div>
  </div>

  {% if not allow_editing %}
  <tc-after-new-trip-plan-panel
    ng-if="pageStateModel.showAfterNewTripPlanPanel"
    align-connector-to="#place-count"
    on-close="pageStateModel.showAfterNewTripPlanPanel = false">
  </tc-after-new-trip-plan-panel>
  {% endif %}

  <script type="text/ng-template" id="info-panel-nav-template">
    <div class="info-panel-nav">
      <span ng-show="!pageStateModel.infoPanelShowExtendedNavItems">
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.DETAILS}">
          <a ng-click="goToInfoPanel(InfoPanelMode.DETAILS)" href="javascript:void(0)">
            <span tc-icon="trip-plan"></span> View Details
          </a>
        </span>
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.GUIDES}">
          <a ng-click="goToInfoPanel(InfoPanelMode.GUIDES)" href="javascript:void(0)">
            <span class="glyphicon glyphicon-book"></span> Browse Guides
          </a>
        </span>
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.ADD_YOUR_OWN}">
          <a ng-click="goToInfoPanel(InfoPanelMode.ADD_YOUR_OWN)"  href="javascript:void(0)">
            <span class="glyphicon glyphicon-plus"></span> Add Your Own
          </a>
        </span>
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.EXPORT}">
          <a ng-click="goToInfoPanel(InfoPanelMode.EXPORT)" href="javascript:void(0)">
            <span class="glyphicon glyphicon-share"></span> Export
          </a>
        </span>
      </span>
      <span ng-show="pageStateModel.infoPanelShowExtendedNavItems">
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.SHARING}">
          <a ng-click="goToInfoPanel(InfoPanelMode.SHARING)" href="javascript:void(0)">
            <span class="glyphicon glyphicon-share-alt"></span> Share
          </a>
        </span>
        <span class="info-nav-item"
          ng-class="{'selected': pageStateModel.infoPanelMode == InfoPanelMode.SETTINGS}">
          <a ng-click="goToInfoPanel(InfoPanelMode.SETTINGS)" href="javascript:void(0)">
            <span class="glyphicon glyphicon-cog"></span> Settings
          </a>
        </span>
      </span>

      <span class="more-item">
        <a ng-click="pageStateModel.infoPanelShowExtendedNavItems = !pageStateModel.infoPanelShowExtendedNavItems"
        href="javascript:void(0)">
          &hellip;
        </a>
      </span>
    </div>
  </script>

  <script type="text/ng-template" id="control-buttons-template">
    <div id="map-buttons" ng-class="{'info-panel-open': pageStateModel.infoPanelExpanded}">
      <button class="btn btn-default" ng-click="openDetailsPanel()"
        ng-show="!pageStateModel.infoPanelExpanded">
        <span class="glyphicon glyphicon-plus"></span>
      </button>
      <button class="btn btn-default" ng-click="closeInfoPanel()"
        ng-show="pageStateModel.infoPanelExpanded">
        <span class="glyphicon glyphicon-minus"></span>
      </button>
    </div>
  </script>

  {% if allow_editing %}
  <script type="text/ng-template" id="trip-plan-settings-dropdown-template">
    <ul class="dropdown-menu right-top-dropdown-menu">
      <li>
        <a ng-click="openTripPlanEditor('trip-plan-settings-editor-modal')" href="javascript:void(0)">Edit trip name and settings</a>
      </li>
      <li>
        <a ng-click="openDayPlanner('day-planner-modal-window')" href="javascript:void(0)">Advanced Planner</a>
      </li>
      <li>
        <a ng-click="startGmapsImport()" href="javascript:void(0)">Import Google Custom Map</a>
      </li>
      <li>
        <a ng-click="deleteCurrentTripPlan()" href="javascript:void(0)">Delete Trip</a>
      </li>
    </ul>
  </script>
  {% endif %}

  <script type="text/ng-template" id="infowindow-template">
    <div class="infowindow" ng-controller="InfowindowCtrl">
      <div class="infowindow-internal">
        <div class="info-section">
          <div class="name">
            [[ed['name'] ]]
          </div>
          <div class="day-and-star" ng-show="showInfoSection()">
            <span ng-show="ed['day']" class="day">Day [[ed['day'] ]]</span>
            <span ng-show="ed['starred']" class="glyphicon glyphicon-star favorite-star"></span>
            <span ng-show="ed['address_precision'] == 'Imprecise'" class="glyphicon glyphicon-exclamation-sign"
              tooltip="Location is approximate"><span>
          </div>
        </div>
        <div class="comments-section" ng-if="ed['comments'] && ed['comments'].length">
          <div ng-repeat="comment in ed['comments']" class="one-comment">
            <div>
              <span class="comment-sidebar">
                <span tc-user-icon user="comment['user']">
                </span>
              </span>
              <span class="comment-details">
                <div>
                  <span ng-bind-html="comment['text'] | linky:'_blank'" class="text"></span>
                </div>
                <div class="comment-timestamp">
                  [[comment['last_modified'] | date: 'short']]
                </div>
              </span>
            </div>
          </div>
        </div>
        <div class="workspace-section" ng-if="workspaceActive()">
          <div ng-if="inlineEditMode == InlineEditMode.COMMENTS" class="inline-comment-editor">
            <div class="author-name">
              <span tc-user-icon user="accountInfo['user']">
              </span>
            </div>
            <textarea class="form-control" placeholder="Add a comment"
              tc-focus-on="inlineEditMode"
              ng-model="newComment['text']">
            </textarea>
            <div>
              <a ng-click="saveNewComment()" href="javascript:void(0)" class="color-link">Save</a>
              <a ng-click="closeInlineEditor()" href="javascript:void(0)" class="cancel-link">Cancel</a>
            </div>
          </div>
          <div ng-if="inlineEditMode == InlineEditMode.DAY_PLANNER">
            <tc-day-select-dropdown entity-data="ed" on-select="closeInlineEditor()">
            </tc-day-select-dropdown>
          </div>
          <div ng-if="inlineEditMode == InlineEditMode.DIRECTIONS" class="directions-planner">
            Get directions
            <a ng-click="toggleDirectionsDirection()" href="javascript:void(0)">
              [[directionsState.direction == 'to' ? 'to' : 'from' ]]
            </a>
            <select class="form-control"
              ng-options="e['name'] for e in allEntities"
              ng-model="directionsState.destination">
              <option value="">Select destination</option>
            </select>
            <button class="btn btn-primary go-button" ng-click="getDirections()"
              ng-disabled="!directionsState.destination">
              Go
            </button>
          </div>
        </div>
        <div class="tool-section" ng-include="'map-marker-tools-template'"
          ng-show="!pageStateModel.inAddPlacePanel()">
        </div>
      </div>
    </div>
  </script>

  {% if allow_editing %}
  <script type="text/ng-template" id="results-infowindow-template">
    <div class="infowindow results-infowindow">
      <div class="infowindow-internal">
        <div class="info-section">
          <div class="name">
            [[ed['name'] ]]
          </div>
        </div>
        <div class="tools-section">
          <a ng-click="saveResult()" href="javascript:void(0)"
            ng-show="!searchResultState.savedResultIndices[index]">
            <span class="glyphicon glyphicon-plus"></span> Add to trip
          </a>
          <div class="save-confirmation" ng-show="searchResultState.savedResultIndices[index]">
            saved
          </div>
        </div>
      </div>
    </div>
  </script>
  {% endif %}

  <script type="text/ng-template" id="map-marker-tools-template">
    <div class="marker-tools">
      {% if allow_editing %}
      <span ng-show="showPrimaryControls">
        <a ng-click="toggleInlineEdit(InlineEditMode.COMMENTS)" href="javascript:void(0)" tooltip="Comment" tooltip-placement="bottom">
          <span tc-icon="comment"></span>
        </a>
        <a ng-click="toggleInlineEdit(InlineEditMode.DAY_PLANNER)" href="javascript:void(0)" tooltip="Add to day" tooltip-placement="bottom">
          <span tc-icon="calendar"></span>
        </a>
        <a ng-click="saveStarState(true)" ng-show="!ed['starred']" href="javascript:void(0)" tooltip="Favorite" tooltip-placement="bottom">
          <span class="glyphicon glyphicon-star-empty"></span>
        </a>
        <a ng-click="saveStarState(false)" ng-show="ed['starred']" href="javascript:void(0)" tooltip="Un-favorite" tooltip-placement="bottom">
          <span class="glyphicon glyphicon-star favorite-star"></span>
        </a>
      </span>
      <span ng-show="showSecondaryControls">
        <a ng-click="toggleInlineEdit(InlineEditMode.DIRECTIONS)" href="javascript:void(0)" tooltip="Get directions"
        tooltip-placement="bottom">
          <span tc-icon="compass"></span>
        </a>
        <a ng-click="openEditPlaceModal('edit-place-modal')" href="javascript:void(0)" tooltip="Edit" tooltip-placement="bottom">
          <span class="glyphicon glyphicon-pencil"></span>
        </a>
        <a ng-click="deleteEntity()" href="javascript:void(0)"
          tooltip="Delete" tooltip-placement="bottom">
          <span class="glyphicon glyphicon-trash"></span>
        </a>
      </span>
      <span class="control-toggle">
        <a ng-click="toggleControls()" href="javascript:void(0)"
          tooltip="More controls" tooltip-placement="bottom">
          &hellip;
        </a>
      </span>
      {% else %}
      <a ng-click="!activeTripPlanState.isSaved(ed) && reclipEntity()"
        ng-class="{'already-clipped': activeTripPlanState.isSaved(ed)}"
        href="javascript:void(0)"
        tooltip="Clip this place" tooltip-placement="bottom">
        <span class="glyphicon glyphicon-paperclip"></span>
      </a>
      <a ng-click="toggleInlineEdit(InlineEditMode.DIRECTIONS)" href="javascript:void(0)" tooltip="Get directions"
        tooltip-placement="bottom">
        <span tc-icon="compass"></span>
      </a>
      {% endif %}
    </div>
  </script>

  <script type="text/ng-template" id="day-select-dropdown-template">
    <select class="form-control"
      ng-options="option.createNew ? 'Add a new day' : 'Day ' + option.dayNumber for option in getDaySelectOptions()"
      ng-model="selectedDayState.dayModel"
      ng-change="organizeIntoDay()">
      <option value="" ng-if="!ed['day']">--Add to day--</option>
    </select>
  </script>

  <script type="text/ng-template" id="reclip-confirmation-template">
    <div ng-controller="ReclipConfirmationCtrl" class="reclip-confirmation-modal">
      <div ng-show="!reclipSucceeded">
        <div>Reclip <b>[[ed['name'] ]]</b> to:</div>
        <div tc-trip-plan-select-dropdown select-trip-plan-to="selectionState.selectedTripPlan" class="reclip-confirmation-trip-plan-dropdown"></div>
        <div ng-show="showSaveButtons()">
          <button class="btn btn-primary" ng-click="reclipEntity()">
            Save
          </button>
          <button class="btn" ng-click="dismissReclipConfirmation()">
            Cancel
          </button>
        </div>
      </div>

      <div ng-show="reclipSucceeded">
        <div class="clip-success-checkmark">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 95.453 100" enable-background="new 0 0 95.453 100" xml:space="preserve">
          <g>
            <g>
              <polygon points="94.587,27.48 31.657,86.15 31.217,85.68 18.847,72.41 0.566,52.81 14.106,40.19 32.387,59.79 81.776,13.74"/>
            </g>
          </g>
          </svg>
        </div>
        Successfully clipped <b>[[ed['name'] ]]</b> to
        <a href="/trip_plan/[[selectionState.selectedTripPlan['trip_plan_id'] ]]" target="_blank">
          [[selectionState.selectedTripPlan['name'] ]]
        </a>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="edit-place-modal-template">
    <div class="edit-place" ng-controller="EditPlaceCtrl">
      <div class="edit-header">
        <span class="editor-title">Editor</span>
        <select ng-options="e['name'] for e in allEntities track by e['entity_id']"
          ng-model="selectedEntity" ng-change="selectedEntityChanged()">
        </select>
        <div class="button-panel">
          <button class="btn btn-primary" ng-click="saveEntity()">
            Save
          </button>
          <button class="btn btn-default" ng-click="$close()">
            Cancel
          </button>
        </div>
      </div>
      <div class="container-fluid editor-body">
        <div class="row">
          <div class="col-sm-6">
            <input type="text" class="form-control" ng-model="ed['name']" placeholder="Place name"/>
            <textarea class="form-control description-input" ng-model="ed['description']"
              placeholder="Description"></textarea>
            <div class="editable-carousel" ng-if="ed['photo_urls'] && ed['photo_urls'].length">
              <div tc-image-carousel urls="ed['photo_urls']" current-index="selectedPhoto.index">
              </div>
              <div class="photo-top-control">
                <a ng-click="setPhotoAsPrimary()" href="javascript:void(0)">
                  Set as Primary <span class="glyphicon glyphicon-picture"></span>
                </a>
              </div>
              <div class="photo-bottom-control">
                <a ng-click="deletePhoto()" href="javascript:void(0)">
                  Delete Photo <span class="glyphicon glyphicon-trash"></span>
                </a>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <input type="text" class="form-control" ng-model="ed['address']" placeholder="Search for an address"
              tc-google-place-autocomplete search-bounds-json="locationBounds"
              location-types="geocode" on-place-change="addressChanged($newPlace)"/>
            <div class="map-container">
              <div tc-google-map class="map" map="mapState.map" map-options="mapOptions" after-creation="setupMap($map)">
              </div>
            </div>
            <tc-entity-marker map="mapState.map" marker="markerState.marker"
              position="markerState.position"
              category-name="ed['category'] && ed['category']['name']"
              icon-template-name="iconTemplateName()"
              precise="ed['address_precision'] == 'Precise'"
              draggable="true" on-drag-end="markerDragged($position)">
            </tc-entity-marker>
            <form class="form-inline precision-and-star-strip" role="form">
              <input type="radio" class="form-control" value="Precise" ng-model="ed['address_precision']" id="precise-radio"/>
              <label for="precise-radio">Exact location</label>
              <input type="radio" class="form-control" value="Imprecise" ng-model="ed['address_precision']" id="imprecise-radio"/>
              <label for="imprecise-radio">Approximate location</label>
              <a ng-click="ed['starred'] = !ed['starred']" href="javascript:void(0)" class="star-control">
                <span class="glyphicon glyphicon-star"
                  ng-class="{'glyphicon-star': ed['starred'], 'glyphicon-star-empty': !ed['starred'], 'favorite-star': ed['starred']}">
                </span>
              </a>
            </form>
            <select class="form-control" ng-model="ed['category']"
              ng-options="c['display_name'] for c in categories track by c['category_id']"
              ng-change="categoryChanged()">
            </select>
            <select class="form-control" ng-model="ed['sub_category']"
              ng-options="s['display_name'] for s in getSubCategories(ed['category']['category_id']) track by s['sub_category_id']">
            </select>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="day-planner-template">
    <div ng-controller="DayPlannerCtrl" class="day-planner-modal">
      <div class="day-planner-header">
        <div class="day-planner-header-text">Plan Itinerary</div>
        <div class="day-planner-persistent-controls">
          <button class="btn btn-primary" ng-click="saveOrderings()">
            Save
          </button>
          <button class="btn" ng-click="$close()">
            Cancel
          </button>
        </div>
      </div>
      <div class="container-fluid day-planner-body">
        <div class="row-fluid">
          <div class="col-md-5 day-planner-left-panel">
            <div class="day-planner-left-panel-drag-area"
              ng-class="{'dragactive': showLeftPanelDragActive(), 'dragover': showLeftPanelDragover()}"
              tc-dragenter="onLeftPanelDragenter($event)"
              tc-dragleave="leftPanelDragover = false"
              tc-dragover="onLeftPanelDragover($event)"
              tc-dragend="onDragend(); leftPanelDragover = false"
              tc-drop="handleLeftPanelDrop($event)"
            >
              <h4 class="day-planner-panel-header">Not Planned By Day</h4>
              <div ng-repeat="item in dpm.unorderedItems" class="day-planner-unsorted-item">
                <tc-draggable-entity item="item" drag-item="dragItem"
                on-dragstart="onDragstart($event, item)" on-dragend="onDragend()">
                </tc-draggable-entity>
              </div>
            </div>
          </div>
          <div class="col-md-7 day-planner-right-panel">
            <div ng-repeat="dayModel in dpm.dayModels">
              <div class="day-planner-one-day" ng-controller="DayPlannerOneDayCtrl"
                ng-class="{'dragover': dayDragover && isValidDayForDrop()}"
                tc-dragenter="onDayDragenter($event)"
                tc-dragleave="dayDragover = false"
                tc-dragover="onDayDragover($event)"
                tc-dragend="onDragend(); dayDragover = false"
                tc-drop="handleDayDrop($event, dayModel); dayDrover = false;"
              >
                <h4 class="day-planner-day-heading">
                  Day [[dayModel.dayNumber]]
                  <span class="day-planner-edit-note-control" ng-show="!editingNote">
                    <a ng-click="openNoteEditor()" href="javascript:void(0)"
                      tooltip="Add a note" tooltip-placement="bottom">
                      <span class="glyphicon glyphicon-pencil"></span>
                    </a>
                  </span>
                </h4>

                <div class="day-planner-one-day-controls dropdown">
                  <a href="javascript:void(0)" class="dropdown-toggle">
                    <span class="glyphicon glyphicon-cog"></span>
                  </a>
                  <ul class="dropdown-menu right-top-dropdown-menu">
                    <li>
                      <a ng-click="dpm.clearDay(dayModel)" href="javascript:void(0)">
                        <span class="glyphicon glyphicon-remove"></span> Clear day
                      </a>
                      <a ng-click="dpm.deleteDay(dayModel)" href="javascript:void(0)">
                        <span class="glyphicon glyphicon-trash"></span> Remove day from trip
                      </a>
                    </li>
                  </ul>
                </div>

                <div ng-show="!editingNote" class="day-planner-one-day-note">[[dayModel.noteItem.data['text'] ]]</div>
                <div ng-show="editingNote">
                  <textarea class="form-control" ng-model="dayModel.noteItem.data['text']"
                    tc-focus-on="editingNote" ng-blur="closeNoteEditor()"
                    placeholder="Enter a note about this day">
                  </textarea>
                </div>
                <div ng-show="!dayModel.hasItems()" class="day-planner-day-cta">
                  Drag and drop places here to plan by day
                </div>
                <div tc-item-drop-target day="dayModel.dayNumber" position="0"
                  drag-item="dragItem" on-drop="handleDrop(dayModel.dayNumber, 0)">
                </div>
                <div ng-repeat="itemModel in dayModel.getItems()">
                  <tc-draggable-entity item="itemModel" drag-item="dragItem"
                    on-dragstart="onDragstart($event, itemModel)" on-dragend="onDragend()"
                    on-clear="clearItem(itemModel)">
                  </tc-draggable-entity>
                  <div tc-item-drop-target day="dayModel.dayNumber" position="itemModel.position() + 1"
                    drag-item="dragItem" on-drop="handleDrop(dayModel.dayNumber, itemModel.position() + 1)">
                  </div>
                </div>
              </div>
            </div>

            <div class="day-planner-controls">
              <button class="btn btn-default day-planner-add-day-button" ng-click="addNewDay()">
                <span class="glyphicon glyphicon-plus"></span> Add a day
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="day-planner-drop-target-template">
    <div class="day-planner-drop-target"
      ng-class="{'dragactive': isDragActive(), 'dragover': dragover}"
      tc-dragenter="onDragenter($event)"
      tc-dragleave="onDragleave($event)"
      tc-dragover="onDragover($event)"
      tc-drop="onDrop(); dropDone($event)"
    >
      <div class="day-planner-drop-target-inner"
        tc-dragenter="onInnerDragenter()"
        tc-dragleave="onInnerDragleave()">
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="day-planner-entity-item-template">
    <div draggable="true" class="day-planner-draggable-entity"
      ng-class="{'existing-item-dragactive': activeItemIsThis(item)}"
      tc-dragstart="onDragstart({$event: $event})" tc-dragend="onDragend()">
      <tc-entity-listing entity-data="item.data">
      </tc-entity-listing>
      <div class="draggable-entity-controls">
        <a ng-click="onClear()" href="javascript:void(0)" tooltip="Remove from day">
          <span class="glyphicon glyphicon-remove"></span>
        </a>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="item-group-template">
    <div ng-controller="ItemGroupCtrl" ng-show="itemGroupModel.hasContent()" ng-if="itemGroupModel.getEntityItems().length != 0">
      <div ng-include="'item-group-header-template'">
      </div>
      <div ng-show="show()">
        <div ng-repeat="item in itemGroupModel.getNonemptyNoteItems()">
          <div ng-include="'mapview-one-note-template'">
          </div>
        </div>
        <div ng-repeat="item in itemGroupModel.getEntityItems()">
          <div ng-include="'one-entity-summary-template'">
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="item-group-header-template">
    <div class="item-group-header">
      <h4>
        <span ng-include="'item-group-header-text-template'"></span>
      </h4>
      <div class="item-group-controls">
        <a ng-click="emphasizeDay(itemGroupModel.groupKey); centerMapOnGroup()"
          ng-show="pageStateModel.isGroupByDay() &&
            itemGroupModel.groupKey &&
            filterModel.emphasizedDayNumber != itemGroupModel.groupKey"
          href="javascript:void(0)" class="emphasis-control white-link"
          tooltip="Focus on this day" tooltip-placement="bottom" tooltip-append-to-body="true">
          <span tc-icon="zoom-select" class="emphasis-zoom-icon"></span>
        </a>
        <a ng-click="deemphasizeDay()"
          ng-show="pageStateModel.isGroupByDay() &&
            itemGroupModel.groupKey &&
            filterModel.emphasizedDayNumber == itemGroupModel.groupKey"
          href="javascript:void(0)" class="deemphasis-control white-link"
          tooltip="Un-focus on this day" tooltip-placement="bottom" tooltip-append-to-body="true">
          <span tc-icon="zoom-deselect" class="emphasis-zoom-icon"></span>
        </a>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="item-group-header-text-template">
    <span ng-if="itemGroupModel.isDayGrouping()">
      <span ng-if="itemGroupModel.groupKey > 0">
        Day [[itemGroupModel.groupKey]]
      </span>
      <span ng-if="!itemGroupModel.groupKey">
        Not Planned By Day
      </span>
    </span>
    <span ng-if="itemGroupModel.isCategoryGrouping()">
      <span ng-switch on="itemGroupModel.groupKey">
        {# TODO: Put the taxonomy here and just get the display name
           given the category id. #}
        <span ng-switch-when="lodging">Lodging</span>
        <span ng-switch-when="food_and_drink">Food &amp; Drink</span>
        <span ng-switch-when="attractions">Attractions</span>
        <span ng-switch-when="activities">Activities</span>
        <span ng-switch-when="entertainment">Entertainment</span>
        <span ng-switch-when="shopping">Shopping</span>
        <span ng-switch-when="region">Regions</span>
        <span ng-switch-when="transportation">Transportation</span>
        <span ng-switch-default>Not Categorized</span>
      </span>
    </span>
  </script>

  <script type="text/ng-template" id="one-entity-summary-template">
    <div ng-controller="EntityCtrl" class="one-entity-summary"
      tc-entity-id="[[ed['entity_id'] ]]"
      ng-class="{'selected': pageStateModel.entityIsSelected(ed['entity_id']),
        'controls-open': controlState.open}"
      ng-click="selectEntity(ed); openInfowindow()">
      <a class="scroll-anchor"></a>
      <span class="entity-circle-img">
        <img ng-src="[[item.getBackgroundImageUrl(planModel.locationLatlng())]]"/>
      </span>
      <span class="entity-info" ng-show="!controlState.open">
        <div class="name">
          [[ed['name'] ]]
        </div>
        <div class="details">
          <span ng-show="item.hasCategory()"
            ng-class="'text-' + ed['category']['name']">
            [[item.categoryDisplayText()]]
          </span>
          <span ng-show="ed['comments'] && ed['comments'].length" class="quickinfo-icon" tc-icon="comment">
          </span>
          </span>
          <span ng-show="item.day() && pageStateModel.isGroupByCategory()"
            class="quickinfo-icon" ng-class="day">
            Day [[item.day()]]
          </span>
          <span class="glyphicon glyphicon-star favorite-star quickinfo-icon" ng-show="ed['starred']">
          </span>
        </div>
      </span>
      <span class="controls" ng-show="controlState.open" ng-click="$event.stopPropagation()">
        <span ng-show="!controlState.showSecondaryControls">
          <a ng-click="openInlineEdit(InlineEditMode.COMMENTS); closeControls()"
            href="javascript:void(0)" tooltip="Comment" tooltip-placement="bottom">
            <span tc-icon="comment"></span>
          </a>
          <a ng-click="openInlineEdit(InlineEditMode.DAY_PLANNER); closeControls()"
            href="javascript:void(0)"
            tooltip="Add to day" tooltip-placement="bottom">
            <span tc-icon="calendar"></span>
          </a>
          <a ng-click="saveStarState(true); closeControls()"
            ng-show="!ed['starred']" href="javascript:void(0)" tooltip="Favorite" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-star-empty"></span>
          </a>
          <a ng-click="saveStarState(false); closeControls()"
            ng-show="ed['starred']" href="javascript:void(0)" tooltip="Un-favorite" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-star favorite-star"></span>
          </a>
        </span>
        <span ng-show="controlState.showSecondaryControls">
          <a ng-click="openInlineEdit(InlineEditMode.DIRECTIONS); closeControls()"
            href="javascript:void(0)"
            tooltip="Get directions" tooltip-placement="bottom">
            <span tc-icon="compass"></span>
          </a>
          <a ng-click="openEditPlaceModal('edit-place-modal'); closeControls()"
            href="javascript:void(0)" tooltip="Edit" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-pencil"></span>
          </a>
          <a ng-click="deleteEntity(); closeControls()"
            href="javascript:void(0)"
            tooltip="Delete" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-trash"></span>
          </a>
        </span>
        <span class="control-toggle">
          <a ng-click="controlState.showSecondaryControls = !controlState.showSecondaryControls"
            href="javascript:void(0)"
            tooltip="More controls" tooltip-placement="bottom">
            &hellip;
          </a>
        </span>
      </span>
      {% if allow_editing %}
      <div class="control-cog-section" ng-click="$event.stopPropagation()">
        <span class="control-cog">
          <a ng-click="openControls()" href="javascript:void(0)" class="white-link"
            ng-show="!controlState.open">
            <span class="glyphicon glyphicon-cog"></span>
          </a>
          <a ng-click="closeControls()" href="javascript:void(0)" class="white-link"
            ng-show="controlState.open">
            <span class="glyphicon glyphicon-remove"></span>
          </a>
        </span>
      </div>
      {% endif %}
      <tc-entity-marker ng-if="position"
        map="map" marker="markerState.marker" position="position"
        category-name="ed['category'] && ed['category']['name']"
        icon-template-name="markerState.iconTemplateName"
        selected="pageStateModel.entityIsSelected(ed['entity_id'])"
        precise="ed['address_precision'] == 'Precise'"
        starred="ed['starred']" has-comments="ed['comments'] && ed['comments'].length"
        emphasized="markerState.emphasized" deemphasized="markerState.deemphasized"
        on-click="markerClicked($event)">
      </tc-entity-marker>
    </div>
  </script>

  <script type="text/ng-template" id="one-entity-listing-template">
    <div class="one-entity-listing"
      tc-entity-id="[[ed['entity_id'] ]]"
      ng-class="{'selected': isSelected({$entityData: ed})}"
      ng-click="onSelect({$entityData: ed})">
      <span class="entity-circle-img">
        <img ng-src="[[im.getBackgroundImageUrl()]]" draggable="false"/>
      </span>
      <span class="entity-info">
        <div class="name">
          [[ed['name'] ]]
        </div>
        <div class="details">
          <span ng-show="im.hasCategory()"
            ng-class="'text-' + ed['category']['name']">
            [[im.categoryDisplayText()]]
          </span>
          <span ng-show="im.day() && shouldShowDay" ng-class="day">
            Day [[im.day()]]
          </span>
          <span class="glyphicon glyphicon-star favorite-star" ng-show="ed['starred']">
          </span>
        </div>
      </span>
    </div>
  </script>

  <script type="text/ng-template" id="mapview-one-note-template">
    <div ng-controller="NoteCtrl" class="one-note-mapview">
      <div ng-show="!editing">
        <div class="note-text">[[nd['text'] ]]</div>
      </div>
      <div ng-show="editing">
        <textarea ng-model="nd['text']" tc-focus-on="editing" class="form-control"
          ng-blur="saveNote()">
        </textarea>
      </div>
      <div class="controls" ng-show="!editing">
        <a ng-click="openEditNote()" href="javascript:void(0)">
          <span class="glyphicon glyphicon-pencil"></span>
        </a>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="details-panel-template">
    <div class="details-panel"
      tc-scroll-to-selector scroll-on-changes-to="pageStateModel.selectedEntity"
      scroll-dest-selector=".one-entity-details[tc-entity-id='[[pageStateModel.selectedEntity['entity_id'] ]]']">
      <tc-trip-plan-details-header trip-plan="planModel.tripPlanData"
        num-entities="planModel.numEntities()" for-guide="false" full-bleed="true">
      </tc-trip-plan-details-header>
      <div class="description" ng-if="planModel.tripPlanData['description']"><span ng-bind-html="planModel.tripPlanData['description'] | linky:'_blank'"></span></div>
      <tc-entity-details ng-repeat="entity in planModel.entities()"
        entity="entity" is-editable="{{allow_editing | jsbool}}" for-results="false"
        trip-plan-id="planModel.tripPlanId()">
      </tc-entity-details>
    </div>
  </script>

  <script type="text/ng-template" id="guideview-one-entity-template">
    <div ng-controller="GuideviewEntityCtrl"
      class="one-entity-guideview"
      ng-show="show()"
      tc-entity-id="[[ed['entity_id'] ]]">
      <hr class="entity-separator"/>
      <div class="name">
        <h4>[[ed['name'] ]]</h4>
      </div>
      <div ng-if="item.hasPhotos()" class="photo-carousel">
        <span class="vertical-spacer"></span><!--
        --><span tc-image-carousel urls="ed['photo_urls']" class="carousel-content">
        </span>
      </div>
       <div class="metadata">
        <div class="address">
          [[ed['address'] ]]
        </div>
        <div class="source-info" ng-show="ed['source_url']">
          <a ng-href="[[ed['source_url'] ]]" target="_blank">
            From <span class="source-text">[[ed['source_url'] | hostname ]]</span>
          </a>
        </div>
      </div>
      <div class="description"><span ng-bind-html="ed['description'] | linky:'_blank'"></span></div>
      <div class="comments" ng-if="ed['comments'] && ed['comments'].length">
        <div class="comments-header">
          Comments
        </div>
        <div class="comments-body">
          <div ng-repeat="comment in ed['comments']" class="one-comment">
            <span class="comment-sidebar">
              <span tc-user-icon user="comment['user']">
              </span>
            </span>
            <span class="comment-details">
              <div ng-show="!editingComment || editingComment['comment_id'] != comment['comment_id']">
                <div>
                  <span ng-bind-html="comment['text'] | linky:'_blank'" class="text comment-content"></span>
                  <a ng-click="openCommentEdit(comment)" ng-if="comment['user']['public_id'] == accountInfo['user']['public_id']"
                    href="javascript:void(0)" class="color-link comment-edit-link">
                    <span class="glyphicon glyphicon-pencil"></span>
                  </a>
                  <a ng-click="deleteComment(comment)" ng-if="comment['user']['public_id'] == accountInfo['user']['public_id']"
                    href="javascript:void(0)" class="color-link comment-edit-link">
                    <span class="glyphicon glyphicon-trash"></span>
                  </a>
                </div>
                <div class="comment-timestamp">
                  [[comment['last_modified'] | date: 'short']]
                </div>
              </div>
              <div ng-show="editingComment && editingComment['comment_id'] == comment['comment_id']">
                <textarea class="form-control" ng-model="editingComment['text']"
                  tc-focus-on="editingComment">
                </textarea>
                <div>
                  <a ng-click="saveCommentEdit()" href="javascript:void(0)" class="color-link">Save</a>
                  <a ng-click="closeCommentEdit()" href="javascript:void(0)">Cancel</a>
                </div>
              </div>
            </span>
          </div>
        </div>
      </div>
      {% if allow_editing %}
      <div class="inline-comment-editor inline-editor" ng-if="inlineEditMode == InlineEditMode.COMMENTS">
        <div class="author-name">
          <span tc-user-icon user="accountInfo['user']">
          </span>
        </div>
        <textarea class="form-control" placeholder="Add a comment"
          tc-focus-on="inlineEditMode"
          ng-model="newComment['text']">
        </textarea>
        <div>
          <a ng-click="saveNewComment()" href="javascript:void(0)" class="color-link">Save</a>
          <a ng-click="closeInlineEditor()" href="javascript:void(0)">Cancel</a>
        </div>
      </div>
      <div class="inline-day-planner inline-editor" ng-if="inlineEditMode == InlineEditMode.DAY_PLANNER">
        <tc-day-select-dropdown entity-data="ed" on-select="closeInlineEditor()">
        </tc-day-select-dropdown>
      </div>
      <div class="inline-editor inline-directions" ng-if="inlineEditMode == InlineEditMode.DIRECTIONS">
        Get directions
        <a ng-click="toggleDirectionsDirection()" href="javascript:void(0)" class="color-link">
          [[directionsState.direction == 'to' ? 'to' : 'from' ]]
        </a>
        <select class="form-control directions-select"
          ng-options="e['name'] for e in allEntities"
          ng-model="directionsState.destination">
          <option value="">Select destination</option>
        </select>
        <button class="btn btn-primary go-button" ng-click="getDirections()"
          ng-disabled="!directionsState.destination">
          Go
        </button>
      </div>
      {% endif %}
      <div class="controls">
        {% if allow_editing %}
        <span>
          <a ng-click="toggleInlineEdit(InlineEditMode.COMMENTS)" href="javascript:void(0)"
            tooltip="Comment" tooltip-append-to-body="1" tooltip-placement="bottom">
            <span tc-icon="comment"></span>
          </a>
          <a ng-click="toggleInlineEdit(InlineEditMode.DAY_PLANNER)" href="javascript:void(0)"
            tooltip="Add to day" tooltip-placement="bottom">
            <span tc-icon="calendar"><span>
          </a>
          <a ng-click="saveStarState(true)" href="javascript:void(0)"
            tooltip="Favorite" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-star-empty" ng-show="!ed['starred']"></span>
          </a>
          <a ng-click="saveStarState(false)" href="javascript:void(0)"
            tooltip="Un-favorite" tooltip-placement="bottom">
            <span class="glyphicon glyphicon-star favorite-star" ng-show="ed['starred']"></span>
          </a>
        </span>
        <span class="control-toggle">
          <span ng-show="showSecondaryControls">
            <a ng-click="toggleInlineEdit(InlineEditMode.DIRECTIONS)" href="javascript:void(0)"
              tooltip="Get directions" tooltip-append-to-body="1" tooltip-placement="bottom">
              <span tc-icon="compass"></span>
            </a>
            <a ng-click="openEditPlaceModal('edit-place-modal')" href="javascript:void(0)" tooltip="Edit" tooltip-placement="bottom">
              <span class="glyphicon glyphicon-pencil"><span>
            </a>
            <a ng-click="deleteEntity()" href="javascript:void(0)"
              tooltip="Delete" tooltip-placement="bottom">
              <span class="glyphicon glyphicon-trash"><span>
            </a>
          </span>
          <a ng-click="toggleControls()" href="javascript:void(0)"
            tooltip="More controls" tooltip-append-to-body="1" tooltip-placement="bottom">
            &hellip;
          </a>
        </span>
        {% else %}
        <span class="glyphicon glyphicon-star favorite-star" ng-show="ed['starred']">
        </span>
        <span class="clip-cta">
          <a ng-click="reclipEntity()" ng-show="!activeTripPlanState.isSaved(ed)"
            href="javascript:void(0)">
            Clip to My Trip
            <span class="glyphicon glyphicon-paperclip"></span>
          </a>
          <span ng-show="activeTripPlanState.isSaved(ed)">
            saved
          </span>
        </span>
        {% endif %}
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="trip-plan-header-template">
    <div class="trip-plan-header">
      <span class="trip-name">
        [[planModel.tripPlanData['name'] ]]
      </span>
      <span class="place-count">
        [[planModel.numEntities()]]
      </span>
      <span class="minimize-link">
        <a ng-click="pageStateModel.summaryPanelExpanded = false"
          ng-show="pageStateModel.summaryPanelExpanded"
          href="javascript:void(0)">
          <span class="glyphicon glyphicon-minus"></span>
        </a>
        <a ng-click="pageStateModel.summaryPanelExpanded = true"
          ng-show="!pageStateModel.summaryPanelExpanded"
          href="javascript:void(0)">
          <span class="glyphicon glyphicon-plus"></span>
        </a>
      </span>
    </div>
  </script>

  <script type="text/ng-template" id="trip-plan-details-header-template">
    <div class="trip-plan-details-header"
      ng-class="{'full-bleed': fullBleed, 'clickable': clickable}"
      ng-style="{'background-image': tripPlan['cover_image_url'] && 'url(&quot;' + tripPlan['cover_image_url'] + '&quot;)'}"
      ng-click="clickable && onClick()">
      <div class="trip-plan-info">
        <div class="trip-plan-name">[[tripPlan['name'] ]]</div>
        <div class="trip-plan-metadata">
          <div ng-if="forGuide">
            <img ng-if="tripPlan['source_icon']"
              ng-src="[[tripPlan['source_icon'] ]]" class="source-icon"/>
            Inspired by
            [[tripPlan['source_display_name'] ]]
          </div>
          <div>
            <span ng-show="forGuide && tripPlan['content_display_date']">
              [[tripPlan['content_display_date'] ]]
              |
            </span>
            <span ng-show="numEntities > 1">
              [[numEntities]] places
            </span>
            <span ng-show="numEntities == 1">
              1 place
            </span>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="one-entity-details-template">
    <div class="one-entity-details"
      tc-entity-id="[[forResults ? null : ed['entity_id'] ]]"
      tc-entity-result-id="[[forResults ? resultIndex : null]]">
      <div class="name-and-photos">
        <div ng-if="ed['photo_urls'] && ed['photo_urls'].length" class="photo-carousel">
          <div tc-image-carousel urls="ed['photo_urls']" full-bleed="true" class="carousel-content">
          </div>
        </div>
        <div class="name-section">
          <span class="entity-icon">
            <tc-entity-icon precise="ed['address_precision'] == 'Precise'"
              category-name="ed['category'] && ed['category']['name']"
              icon-template-name="iconTemplateName()">>
            </tc-entity-icon>
          </span>
          <span class="entity-name">
            [[ed['name'] ]]
          </span>
          <span class="star-section">
            <span ng-if="isEditable">
              <a ng-click="saveStarState(true)"
                ng-show="!ed['starred']" href="javascript:void(0)" tooltip="Favorite" tooltip-placement="left">
                <span class="glyphicon glyphicon-star-empty"></span>
              </a>
              <a ng-click="saveStarState(false)"
                ng-show="ed['starred']" href="javascript:void(0)" tooltip="Un-favorite" tooltip-placement="left">
                <span class="glyphicon glyphicon-star favorite-star"></span>
              </a>
            </span>
            <span ng-if="!isEditable">
              <span class="glyphicon glyphicon-star favorite-star"
                ng-show="ed['starred']">
              </span>
            </span>
          </span>
        </div>
      </div>
      <div class="info-tabs">
        <span class="info-tab" ng-class="{'selected': infoTab == InfoTab.ABOUT}"
          ng-show="showAboutTab()">
          <a ng-click="selectInfoTab(InfoTab.ABOUT)" href="javascript:void(0)">
            About
          </a>
        </span>
        <span class="info-tab" ng-class="{'selected': infoTab == InfoTab.DETAILS}">
          <a ng-click="selectInfoTab(InfoTab.DETAILS)" href="javascript:void(0)">
            Details
          </a>
        </span>
        <span class="info-tab" ng-class="{'selected': infoTab == InfoTab.COMMENTS}"
          ng-show="showCommentsTab()">
          <a ng-click="selectInfoTab(InfoTab.COMMENTS)"
            href="javascript:void(0)">
            Comments
          </a>
        </span>
        <span class="add-to-trip-link" ng-show="!isEditable">
          <a ng-click="clipEntity()" ng-show="!isAlreadySaved()" class="cta-link"
            href="javascript:void(0)">
            Add to My Trip
          </a>
          <span ng-show="isAlreadySaved()" class="text-success">
            Saved
          </span>
        </span>
      </div>
      <div class="tab-content">
        <div ng-show="infoTab == InfoTab.ABOUT">
          <div ng-show="ed['origin_trip_plan_name']" class="origin-trip-name">
            Originally from
            <a ng-href="/trip_plan/[[ed['origin_trip_plan_id'] ]]" target="_blank"
              class="underline-link">
              [[ed['origin_trip_plan_name'] ]]
            </a>
          </div>
          <div class="description" ng-if="ed['description']"><span ng-bind-html="ed['description'] | linky:'_blank'"></span></div>
        </div>
        <div ng-show="infoTab == InfoTab.DETAILS">
          <div class="source-attribution" ng-show="ed['source_url']">
            Place info from
            <a ng-href="[[ed['source_url'] ]]" target="_blank">[[ed['source_display_name'] ]]</a>
          </div>
          <div ng-show="ed['address']" class="detail-item">
            Address: [[ed['address'] ]]
          </div>
          <div ng-show="em.hasOpeningHours()" class="detail-item">
            Hours: <span class="opening-hours">[[em.openingHoursStr()]]</span>
          </div>
          <div ng-show="ed['phone_number']" class="detail-item">
            Phone: [[ed['phone_number'] ]]
          </div>
          <div ng-show="ed['website']" class="detail-item">
            Website:
            <a ng-href="[[ed['website'] ]]" target="_blank" class="color-link">
              [[ed['website'] ]]
            </a>
          </div>
          <div ng-if="inlineEditMode == InlineEditMode.DIRECTIONS" class="inline-editor">
            Get directions
            <a ng-click="directionsHelper.toggleDirection()"
              href="javascript:void(0)" class="color-link">
              [[directionsHelper.direction == 'to' ? 'to' : 'from' ]]
            </a>
            <select class="form-control directions-select"
              ng-options="e['name'] for e in directionsHelper.entities"
              ng-model="directionsHelper.destination">
              <option value="">Select destination</option>
            </select>
            <button class="btn btn-primary"
              ng-click="directionsHelper.getDirections(ed)"
              ng-disabled="!directionsHelper.destination">
              Go
            </button>
          </div>
        </div>
      </div>
      <div class="editing-controls" ng-if="isEditable">
        <span class="left-controls">
          <a href="javascript:void(0)">
            <span class="glyphicon glyphicon-tag"></span>
          </a>
          <a ng-click="openDirections()" href="javascript:void(0)">
            <span tc-icon="compass"></span>
          </a>
          <a href="javascript:void(0)">
            <span tc-icon="comment"></span>
          </a>
        </span>
        <span class="right-controls">
          <a ng-click="openEditPlaceModal()" href="javascript:void(0)">
            <span class="glyphicon glyphicon-pencil"></span>
          </a>
          <a ng-click="deleteEntity()" href="javascript:void(0)">
            <span class="glyphicon glyphicon-trash"></span>
          </a>
        </span>
      </div>
      <hr class="entity-separator"/>
    </div>
  </script>

  {% if allow_editing and not plan.location_bounds %}
  <script type="text/ng-template" id="start-new-trip-modal-template">
    <div class="start-new-trip-modal">
      <div tc-start-new-trip-input on-select-place="selectTripLocation($tripPlanDetails)">
      </div>
    </div>
  </script>
  {% endif %}

  {% if allow_editing %}
  <script type="text/ng-template" id="gmaps-importer-template">
    <div class="gmaps-importer-modal" ng-controller="GmapsImporterCtrl">
      <h3>Import a Google custom map</h3>
      <div ng-show="!pendingTripPlan && !newTripPlan">
        <div class="paste-prompt-text">
          Paste a Google Maps Engine or My Maps url
        </div>
        <input type="text" class="form-control" placeholder="Paste a url"
          ng-model="url" ng-paste="urlPasted()" ng-disabled="importing"
          tc-focus-on="ready"/>
        <div ng-show="importing" class="search-spinner">
          <img src="/static/img/spinner-small.gif"/>
        </div>
        <div ng-show="urlInvalid" class="text-danger">
          That's not a vaid Google custom maps url.
        </div>
      </div>
      <div ng-if="saving" class="save-spinner">
        <img src="/static/img/spinner2.gif"/>
      </div>
      <div ng-show="pendingTripPlan && !newTripPlan && !saving">
        <div class="import-success-text">
          Successfully imported [[pendingTripPlan['entities'].length ]] places
          from the map
          <span class="map-name">[[pendingTripPlan['name'] ]]</span>
        </div>
        <form class="form-inline" role="form">
          <input type="radio" class="form-control" value="new" ng-model="importAction" id="new-action"/>
          <label for="new-action">
            Create a new trip plan
          </label>
          <br/>
          <input type="radio" class="form-control" value="import" ng-model="importAction" id="import-action"/>
          <label for="import-action">
            Add all [[pendingTripPlan['entities'].length ]] places to the current trip plan (<span class="map-name">[[currentTripPlanName]]</span>)
          </label>
        </form>
        <div class="buttons">
          <button class="btn btn-primary" ng-click="save()">
            Save
          </button>
          <button class="btn" ng-click="$close()">
            Cancel
          </button>
        </div>
      </div>
      <div ng-show="newTripPlan">
        <div class="import-success-text" ng-show="importAction == 'new'">
          Successfully created the new trip plan
          <a ng-href="/trip_plan/[[newTripPlan['trip_plan_id'] ]]">
            [[newTripPlan['name'] ]]
          </a>
        </div>
        <div class="buttons">
          <button class="btn" ng-click="$close()">
            Close
          </button>
        </div>
      </div>
    </div>
  </script>
  {% endif %}

  {% if allow_editing %}
  <script type="text/ng-template" id="guides-panel-template">
    <div class="guides-panel one-info-panel" ng-controller="GuidesPanelCtrl"
      tc-scroll-to-selector scroll-on-changes-to="searchResultState.selectedIndex"
      scroll-dest-selector=".one-entity-search-result[tc-entity-result-id='[[searchResultState.selectedIndex]]']"
      tc-reset-scroll-top-on="selectedGuide">
      <div ng-show="!selectedGuide">
        <div class="header">
          Browse popular guides for <i>[[planModel.tripPlanData['location_name'] ]]</i>
          to add to your trip
        </div>
        <div ng-show="loading">
          Loading... <img ng-src="/static/img/spinner-small.gif"/>
        </div>
        <div ng-show="!loading && (!guides || !guides.length)" class="no-guides-msg">
          There aren't any featured guides for this area yet.
          <a href="javascript:void(0)">Create your own.</a>
        </div>
        <div ng-show="guides && guides.length">
          <tc-trip-plan-details-header ng-repeat="guide in guides" trip-plan="guide"
            num-entities="guide['entities'].length" for-guide="true"
            clickable="true" on-click="selectGuide(guide)">
          </tc-trip-plan-details-header>
        </div>
      </div>
      <div ng-show="selectedGuide">
        <div class="guide-breadcrumb">
          <a ng-click="backToListings()" class="cta-link" href="javascript:void(0)">
            [[planModel.tripPlanData['location_name'] ]] Guides
          </a>
          &gt;
          [[selectedGuide['name'] ]]
        </div>

        <tc-trip-plan-details-header trip-plan="selectedGuide"
          num-entities="selectedGuide['entities'].length" for-guide="true" full-bleed="true">
        </tc-trip-plan-details-header>
        <div class="description" ng-if="selectedGuide['description']"><span ng-bind-html="selectedGuide['description'] | linky:'_blank'"></span></div>
        <div ng-if="selectedGuide['source_url']" class="source-link">
          <a ng-href="[[selectedGuide['source_url'] ]]" target="_blank" class="cta-link">
            View original article at [[selectedGuide['source_display_name'] ]]
          </a>
        </div>
        <tc-entity-details ng-repeat="entity in selectedGuide['entities']"
          entity="entity" is-editable="false" for-results="true"
          trip-plan-id="selectedGuide['trip_plan_id']" result-index="$index">
        </tc-entity-details>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="add-your-own-panel-template">
    <div class="add-your-own-panel one-info-panel">
      <div class="header">
        Search for places by name, address, or category in
        <i>[[planModel.tripPlanData['location_name'] ]]</i>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="export-panel-template">
    <div class="export-panel one-info-panel">
      <div class="header">
        Take your trip plan with you on the road.
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="sharing-panel-template">
    <div class="export-panel one-info-panel">
      <div class="header">
        Share your trip with collaborators and viewers
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="settings-panel-template">
    <div class="export-panel one-info-panel">
      <div class="header">
        Settings
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="search-panel-template">
    <div class="search-panel" ng-controller="SearchPanelCtrl"
      tc-scroll-to-selector scroll-on-changes-to="searchResultState.selectedIndex"
      scroll-dest-selector=".one-entity-search-result[tc-entity-result-id='[[searchResultState.selectedIndex]]']">
      Search for place names, addresses, or categories to add to your trip
      <div class="search-box-container">
        <input type="text" class="form-control"
          placeholder="e.g. 'Eiffel Tower', '123 Main St', or 'Cafes'"
          tc-google-place-autocomplete search-bounds-json="planModel.tripPlanData['location_bounds']"
          tc-focus-on="pageStateModel.infoPanelMode"
          on-place-change="googlePlaceSelected($newPlace)"
          ng-model="queryState.rawQuery"
          ng-disabled="loadingData"/>
        <div ng-show="loadingData" class="search-spinner">
          <img src="/static/img/spinner-small.gif"/>
        </div>
      </div>
      <div ng-include="'results-details-panel-template'">
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="results-details-panel-template">
    <div class="results-details-panel">
      <div ng-show="searchComplete && searchResults && searchResults.length">
        <h4>Results from Google Maps</h4>
      </div>
      <div ng-repeat="result in searchResultState.results"
        tc-entity-search-result index="$index" entity-data="result"
        search-result-state="searchResultState">
      </div>
      <div ng-show="searchComplete && (!searchResults || !searchResults.length)">
        <h4>No places found</h4>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="one-entity-search-result-template">
    <div class="one-entity-search-result" tc-entity-result-id="[[index]]"
      ng-controller="EntitySearchResultCtrl"
      ng-mouseenter="highlightResult()">
      <hr class="entity-separator" ng-show="index > 0"/>
      <div class="header-bar">
        <span class="result-letter-icon" tc-search-result-icon
          precise="ed['address_precision'] == 'Precise'" result-letter="resultLetter()">
        </span>
        <span class="name">[[ed['name'] ]]</span>
        <div class="controls">
          <span ng-show="!searchResultState.savedResultIndices[index]">
            <a ng-click="saveResult()" href="javascript:void(0)" class="color-link">
              <span class="glyphicon glyphicon-plus"></span>
              Add to trip
            </a>
          </span>
          <span class="save-confirmation" ng-show="searchResultState.savedResultIndices[index]">
            saved
          </span>
        </div>
      </div>
      <div ng-if="ed['photo_urls'] && ed['photo_urls'].length" class="photo-carousel">
        <span class="vertical-spacer"></span><!--
        --><span tc-image-carousel urls="ed['photo_urls']" class="carousel-content">
        </span>
      </div>
       <div class="metadata">
        <div class="address">
          [[ed['address'] ]]
        </div>
        <div class="source-info" ng-show="ed['source_url']">
          <a ng-href="[[ed['source_url'] ]]" target="_blank">
            From <span class="source-text">[[ed['source_url'] | hostname ]]</span>
          </a>
        </div>
      </div>
      <div class="description"><span ng-bind-html="ed['description'] | linky:'_blank'"></span></div>
      <tc-search-result-marker ng-if="position && !searchResultState.savedResultIndices[index]"
        marker="markerState.marker" position="position" map="map"
        precise="ed['address_precision'] == 'Precise'" result-letter="resultLetter()"
        selected="isSelected()"
        on-click="markerClicked($event)">
      </tc-search-result-marker>
    </div>
  </script>

  <script type="text/ng-template" id="web-search-panel-template">
    <div class="web-search-panel" ng-controller="WebSearchPanelCtrl"
      tc-scroll-to-selector scroll-on-changes-to="searchResultState.selectedIndex"
      scroll-dest-selector=".one-entity-search-result[tc-entity-result-id='[[searchResultState.selectedIndex]]']">
      <div>
        Not sure where to go? Browse places rated highly by users and writers on top travel websites.
      </div>
      <div class="sample-site-selector-row">
        Browse
        <span class="inline-dropdown-parent dropdown">
          <button class="btn btn-default dropdown-toggle">
            <img ng-src="[[selectedSite['icon_url'] ]]" class="site-icon"/>
            [[selectedSite['display_name'] ]]
          </button>
          <ul class="dropdown-menu">
            <li ng-repeat="site in sampleSites">
              <a ng-click="selectSite(site)" href="javascript:void(0)">
                <img ng-src="[[site['icon_url'] ]]" class="site-icon"/>
                [[site['display_name'] ]]
              </a>
            </li>
          </ul>
        </span>
        &nbsp;&nbsp;for&nbsp;&nbsp;
        <span class="inline-dropdown-parent" dropdown is-open="queryDropdownState.isopen">
          <button class="btn btn-default dropdown-toggle" ng-disabled="!querySelectEnabled()">
            [[selectedQuery]]
          </button>
          <ul class="dropdown-menu">
            <li ng-repeat="query in selectedSite['sample_queries']">
              <a ng-click="selectQuery(query)" href="javascript:void(0)">
                [[query]]
              </a>
            </li>
            <li ng-click="$event.stopPropagation()"
              ng-if="selectedSite['custom_queries_allowed']">
              <a ng-click="openCustomQuery()"
                ng-show="!customQueryState.active"
                href="javascript:void(0)">
                <span class="custom-search-link" >
                  custom search
                </span>
              </a>
              <span ng-show="customQueryState.active" class="custom-query-row">
                <form ng-submit="selectCustomQuery()">
                  <input type="text" class="form-control custom-query-input" ng-model="customQueryState.input"
                  tc-focus-on="customQueryState.focus"/>
                </form>
              </span>
            </li>
          </ul>
        </span>
        <button ng-click="submitSearch()" class="btn btn-primary">
          Go
        </button>
      </div>
      <div ng-show="searching" class="search-spinner">
        <img ng-src="/static/img/spinner-small.gif"/>
      </div>
      <div class="search-results" ng-if="searchComplete && searchResults && searchResults.length">
        <h4>Results from [[selectedSite['display_name'] ]]</h4>
        <div ng-repeat="result in searchResults"
          tc-entity-search-result index="$index" entity-data="result"
          search-result-state="searchResultState">
        </div>
      </div>
      <div ng-if="searchComplete && (!searchResults || !searchResults.length)">
        <h4>No places found</h4>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="clip-my-own-panel-template">
    <div class="clip-my-own-panel" ng-controller="ClipMyOwnPanelCtrl"
      tc-scroll-to-selector scroll-on-changes-to="searchResultState.selectedIndex"
      scroll-dest-selector=".one-entity-search-result[tc-entity-result-id='[[searchResultState.selectedIndex]]']">
      <p>
        Add places to your trip while browsing other websites.
      </p>
      <p>
        Drag the TravelClipper bookmark to your bookmarks bar to clip places from dozens of
        <a ng-mouseenter="sampleSiteState.hoverShow = true"
          ng-mouseleave="sampleSiteState.hoverShow = false"
          ng-click="openSampleSites()"
          class="color-link" href="javascript:void(0)">
          websites and blogs
        </a>
        in a single click.
        <a href="javascript:void(0)" class="help-prompt" tooltip="Don't see your bookmarks bar? Press Cmd+Shift+B (Mac) or Ctrl+Shift+B (PC)"
          tooltip-placement="left">
          <span class="glyphicon glyphicon-question-sign"></span>
        </a>
      </p>
      <ul class="sample-sites-hover-window" ng-show="sampleSiteState.show()">
        Example Sites:
        <br/><br/>
        <li ng-repeat="site in sampleSupportedSites">
          <img ng-src="[[site.iconUrl]]" class="site-icon"/>
          <span><a ng-href="[[site.url]]" target="_blank">[[site.name]]</a></span>
        </li>
      </ul>
      <div class="bookmarklet">
        <a href="javascript:(function(){c=document.createElement('script');c.type='text/javascript';c.src='{{bookmarklet_url}}'+'?'+Math.floor(Math.random()*99999999);document.body.appendChild(c);})();"
        onclick="event.stopPropagation(); event.preventDefault()">
          <span class="bookmarklet-link">
            <span class="glyphicon glyphicon-paperclip"></span> Travel Clipper
          </span>
        </a>
      </div>
      <p>
        <a ng-click="learnMoreState.expanded = !learnMoreState.expanded" href="javascript:void(0)" class="color-link">
          Learn more
          <span class="glyphicon learn-more-chevron"
            ng-class="{'glyphicon-chevron-down': !learnMoreState.expanded,
                       'glyphicon-chevron-up': learnMoreState.expanded}">
          </span>
        </a>
      </p>
      <div ng-show="learnMoreState.expanded">
        <p>
          The TravelClipper bookmark clips place names, locations, images, and other information from supported websites and automatically adds them to your trip plan.
        </p>
        <p>
          For all other websites, the bookmark helps you quickly clip the information and images you care about.
        </p>
      </div>
      <hr class="section-separator"/>
      <p>
        Try it out without even installing the bookmark.  Paste a url from a supported website to see places from that page:
      </p>
      <div class="search-box-container">
        <form ng-submit="textPasted()">
          <input type="text" class="form-control"
            placeholder="http://..."
            ng-paste="textPasted()"
            tc-focus-on="pageStateModel.infoPanelMode"
            ng-model="state.rawInput"
            ng-disabled="loadingData"/>
        </form>
        <div ng-show="loadingData" class="search-spinner">
          <img src="/static/img/spinner-small.gif"/>
        </div>
      </div>
      <div class="invalid-url text-danger" ng-show="invalidUrl">
        Oops, that doesn't look like a valid url
      </div>
      <div class="results" ng-show="clipComplete && results && results.length">
        <h4>Results from [[siteDomain]]</h4>
        <div ng-repeat="result in results"
          tc-entity-search-result index="$index" entity-data="result"
          search-result-state="searchResultState">
        </div>
      </div>
      <div class="no-results" ng-show="clipComplete && (!results || !results.length)">
        <h4>No results found</h4>
        TravelClipper couldn't automatically find places on that page. Install the bookmark, then
        <a ng-href="[[urlToVisit()]]" target="_blank" class="color-link">visit the website</a>
         to quickly clip information and images.
      </div>
    </div>
    </script>
  {% endif %}

  {% if allow_editing %}
  <script type="text/ng-template" id="trip-plan-settings-editor-template">
    <div class="trip-plan-settings-editor" ng-controller="TripPlanSettingsEditorCtrl">
      <div class="header">
        <div class="title">Trip Plan Settings</div>
        <div class="button-panel">
          <button class="btn btn-primary" ng-click="saveSettings()">
            Save
          </button>
          <button class="btn btn-default" ng-click="$close()">
            Cancel
          </button>
        </div>
      </div>
      <div class="editor-body container-fluid">
        <div class="row">
          <div class="col-sm-6">
            <h4>Name</h4>
            <input type="text" class="form-control" ng-model="tpd['name']"/>
            <h4>Description</h4>
            <textarea class="form-control description-input" ng-model="tpd['description']"></textarea>
          </div>
          <div class="col-sm-6">
            <h4>Cover Image</h4>
            <div class="cover-img-container" ng-if="tpd['cover_image_url'] && !editingImage">
              <img ng-src="[[tpd['cover_image_url'] ]]"/>
              <div class="img-control top-control">
                <a ng-click="changeImage()" href="javascript:void(0)">
                  Change image
                  <span class="glyphicon glyphicon-picture"></span>
                </a>
              </div>
              <div class="img-control bottom-control">
                <a ng-click="removeImage()" href="javascript:void(0)">
                  Remove image
                  <span class="glyphicon glyphicon-trash"></span>
                </a>
              </div>
            </div>
            <div class="cover-img-editor" ng-if="editingImage">
              <textarea class="cover-img-drop-target" placeholder="Drag and drop an image or paste an image url"
                ng-model="coverImgUrlInput.text" ng-change="coverImgUrlChanged()" ng-paste="coverImgUrlPasted()"
                tc-dragenter="coverImgDragenter()" tc-dragover="$event.preventDefault()" tc-drop="coverImgUrlDropped($event)"
                ng-class="{'dragactive': coverImgDragActive}">
              </textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="sharing-settings-editor-template">
    <div class="sharing-settings-editor" ng-controller="SharingSettingsCtrl">
      <div class="header">
        <div class="title">Share</div>
        <div class="button-panel">
          <button class="btn btn-default" ng-click="$close()">
            Close
          </button>
        </div>
      </div>
      <div class="creator">
        <h4>Creator</h4>
        <span tc-user-icon user="creator" no-tooltip="true"></span> [[creator['display_name'] ]]
        <span ng-show="isCreator">(you)</span>
      </div>
      <div ng-show="hasCollaborators()">
        <h4>Collaborators</h4>
        <p ng-repeat="editor in editors()" class="collaborator">
          <span tc-user-icon user="editor" no-tooltip="true"></span>
          [[editor['display_name'] ]]
          <span ng-show="editor['public_id'] == accountInfo['user']['public_id']">
            (you)
          </span>
          <a ng-click="removeEditor(editor)"
            ng-show="editor['public_id'] != accountInfo['user']['public_id']"
            href="javascript:void(0)" class="remove-link color-link">
            <span class="glyphicon glyphicon-trash"></span>
          </a>
        </p>
        <p ng-repeat="inviteeEmail in inviteeEmails()" class="collaborator">
          <span>
            [[inviteeEmail]] (invited)
            <a ng-click="removeInvitee(inviteeEmail)"
              href="javascript:void(0)" class="remove-link color-link">
              <span class="glyphicon glyphicon-trash"></span>
            </a>
          </span>
        </p>
      </div>
      <div>
        <h4>Add Collaborators</h4>
        Collaborators can edit and comment on the trip plan and invite other collaborators.
        <form class="form-inline" role="form" ng-submit="addCollaborator()">
          <div class="form-group">
            <input type="text" class="form-control email-input" placeholder="Enter an email address" ng-model="formState.email"/>
            <button class="btn btn-primary">
              Add
            </button>
          </div>
        </form>
      </div>
      <div>
        <h4>Share Trip Plan</h4>
        Share this trip plan by sending others the trip plan link. Viewers that are not collaborators cannot edit and comment on the trip plan or invite other collaborators.
        <input type="text" class="form-control share-url" disabled="true" ng-model="shareUrl"/>
      </div>
    </div>
  </script>
  {% endif %}

  <script type="text/ng-template" id="bulk-clip-modal-template">
    <div class="bulk-clip-modal" ng-controller="BulkClipCtrl">
      <h2>Clip Places</h2>
      <div>
        Select one or more places to clip to one of your trips
      </div>
      <div class="container-fluid full-height clipper-body">
        <div class="row full-height">
          <div class="col-sm-6 entity-list">
            <div class="select-controls">
              Select:
              <a ng-click="selectAll()" href="javascript:void(0)">All</a>
              <a ng-click="selectNone()" href="javsacript:void(0)">None</a>
            </div>
            <div ng-repeat="entity in allEntities">
              <tc-entity-listing entity-data="entity" on-select="entity.selected = !entity.selected"
                is-selected="entity.selected">
              </tc-entity-listing>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="save-panel" ng-show="!(saving || saved)">
              <div class="save-summary">
                <span ng-show="selectedEntities().length == 0">
                  Select a place to save to
                </span>
                <span ng-show="selectedEntities().length == 1">
                  Save 1 place to
                </span>
                <span ng-show="selectedEntities().length > 1">
                  Save [[selectedEntities().length]] places to
                </span>
              </div>
              <div tc-trip-plan-select-dropdown select-trip-plan-to="selectionState.selectedTripPlan">
              </div>
              <div class="button-panel" ng-show="!selectionState.selectedTripPlan.createNew">
                <button ng-click="save()" class="btn btn-primary" ng-disabled="!selectedEntities().length">
                  Save
                </button>
              </div>
            </div>
            <div class="confirmation-panel" ng-show="saving || saved">
              <div class="saving-msg" ng-show="saving">
                Saving...
                <br/>
                <img src="/static/img/spinner2.gif"/>
              </div>
              <div class="confirmation" ng-show="saved">
                Successfully saved
                <span ng-show="selectedEntities().length == 1">
                  1 place
                </span>
                <span ng-show="selectedEntities().length > 1">
                  [[selectedEntities().length]] places
                </span>
                to
                <a ng-href="/trip_plan/[[selectionState.selectedTripPlan['trip_plan_id'] ]]"
                  target="_blank">
                  [[selectionState.selectedTripPlan['name'] ]]
                </a>
                <div class="close-button">
                  <button class="btn btn-default" ng-click="$close()">
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  {% if needs_tutorial %}
  <script type="text/ng-template" id="tutorial-left-panel-template">
    <div class="tutorial-left-panel">
      <div ng-repeat="ignored in [1, 2, 3]" class="entity-placeholder">
        <span class="img-placeholder">
        </span>
        <span class="details-placeholder">
        </span>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="tutorial-overlay-template">
    <div class="tutorial-overlay" ng-if="planModel.isEmpty() && !pageStateModel.inNewTripPlanModal">
      <div class="backdrop">
      </div>
      <div class="content" ng-show="!pageStateModel.infoPanelExpanded">
        <div class="connector">
        </div>
        <div class="header">Welcome to your [[planModel.tripPlanName()]] trip plan!</div>
        <div class="content-body" ng-controller="AddPlaceOptionsCtrl">
          <div class="intro">Quickly build a personal trip plan by adding places</div>
          <div class="section">
            <span class="section-icon">
              <span class="glyphicon glyphicon-search"></span>
            </span><!--
            --><span class="section-text">
              <a ng-click="setOption(options[0])" href="javascript:void(0)" class="color-link">
                Search
              </a>
              for places - like those your friends and family have recommended
            </span>
          </div>
          <div class="section">
            <span class="section-icon">
              <span class="glyphicon glyphicon-heart"></span>
            </span><!--
            --><span class="section-text">
              Discover places rated highly by users
              <a ng-click="setOption(options[1])" href="javascript:void(0)" class="color-link">
                from the web
              </a>
            </span>
          </div>
          <div class="section">
            <span class="section-icon">
              <span class="glyphicon glyphicon-book"></span>
            </span><!--
            --><span class="section-text">
              View full
              <a ng-click="setOption(options[2])" href="javascript:void(0)" class="color-link">
                travel guides
              </a>
              - then pick and choose the places that you like
            </span>
          </div>
          <div class="section">
            <span class="section-icon">
              <span class="glyphicon glyphicon-paperclip"></span>
            </span><!--
            --><span class="section-text">
              Perform research across the web and
              <a ng-click="setOption(options[3])" href="javascript:void(0)" class="color-link">
                clip your own
              </a>
              places from any website
            </span>
          </div>
        </div>
      </div>
    </div>
  </script>
  {% endif %}

  <script type="text/ng-template" id="user-icon-template">
    <a href="javascript:void(0)" tooltip="[[noTooltip ? null : user['display_name'] ]]"
      tooltip-append-to-body="true">
      <span class="user-icon"
        ng-class="'user-' + userStyleIdentifier()">
        [[user['display_name'].substring(0, 1) ]]
      </span>
    </a>
  </script>

  <script type="text/ng-template" id="after-new-trip-plan-panel-template">
    <div class="after-new-trip-plan-panel" id="after-new-trip-plan-panel">
      <div class="connector">
      </div>
      <div class="panel-body">
        <div class="close-button">
          <a ng-click="onClose()" href="javascript:void(0)">
            <span class="glyphicon glyphicon-remove"></span>
          </a>
        </div>
        <div class="header">Created a new trip!</div>
        <div>
          <p>
            <i>[[activeTripPlanState.lastClippedEntity['name'] ]]</i> was added to this trip.
          </p>
          <p ng-show="activeTripPlanState.numEntities == 1">
            You have 1 place in this trip.
          </p>
          <p ng-show="activeTripPlanState.numEntities > 1">
            You have [[activeTripPlanState.numEntities]] places in this trip.
          </p>
        </div>
        <div>
          Go to your trip plan or add more places while browsing guides.
        </div>
        <div class="button-panel">
          <button ng-click="goToTripPlan()" class="btn btn-primary">
            View Trip Plan
          </button>
          <span class="button-separator"></span>
          <button class="btn btn-cta" ng-click="onClose()">
            Keep Browsing
          </button>
        </div>
      </div>
    </div>
  </script>

  {% include 'nav.html' %}
  {% include 'widgets.html' %}
  {% include 'map_markers.html' %}
  {% include 'icons.html' %}

  <script>
    initApp(
      {{plan.to_json_str()|safe}},
      {{entities_json|safe}},
      {{notes_json|safe}},
      {{to_json_str(all_trip_plans)|safe}},
      {{to_json_str(active_trip_plan)|safe}},
      {{active_trip_plan_entity_count}},
      {{account_info.to_json_str()|safe}},
      {{all_datatype_values.to_json_str()|safe}},
      {{allow_editing|jsbool}},
      {{sample_sites_json|safe}},
      {{initial_state.to_json_str()|safe}},
      {{to_json_str(flashed_messages)|safe}});
  </script>
</body>
</html>
