<!doctype html>
<html>
<head>
  <title>{{plan.name}}</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//maps.googleapis.com/maps/api/js?sensor=false"></script>
  <script src="/static/js/imagesloaded.pkgd.min.js"></script>
  <script src="/static/js/masonry.pkgd.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.14/angular.min.js"></script>
  <script src="/static/js/ui-bootstrap-tpls-0.10.9.js"></script>
  <script src="/static/js/angular-masonry.min.js"></script>
  <script src="/static/js/script.js"></script>
  <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400|Raleway:400">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="shortcut icon" href="/static/img/globe.png">
</head>
<body ng-controller="RootCtrl">
  <nav class="navbar navbar-default navbar-fixed-top" id="upper-navbar">
    <div class="upper-nav container">
      <div class="row">
        <div class="col-md-3" id="logo"><a href="/">Travel Clipper</a></div>
        <div class="col-md-6" id="trip-plan-title">
          <span ng-show="!editingTripPlanSettings">[[editableTripPlanSettings['name'] ]]</span>
          <form class="form-inline" role="form" onsubmit="return false" ng-show="editingTripPlanSettings">
            <input class="form-control" id="trip-plan-title-input" type="text" ng-model="editableTripPlanSettings.name"/>
            <button class="btn btn-save-changes" ng-click="saveTripPlanSettings()">Save</button>
          </form>
          <a href="javascript:void(0)" ng-click="editTripPlanSettings()" ng-show="!editingTripPlanSettings">
            <button type="button" class="btn btn-sm" id="edit-title-btn">
              <span class="glyphicon glyphicon-pencil"></span>
            </button>
          </a>
        </div>
        <div class="col-md-3" id="my-account-link">
          <a href="javascript:void(0)" ng-click="toggleAccountDropdown()">My Trip Plans</a>
        </div>
      </div>
    </div>
  </nav> 
  <nav class="navbar navbar-fixed-top" id="lower-navbar">
    <div class="lower-nav container" ng-controller="NavigationCtrl">
      <div class="row">
        <div class="entity-nav">
          <a href="javascript:void(0)" ng-scroll-to-on-click="navAnchor('Hotel')">
            <div class="col-md-1 navigation-link">
              Hotels
            </div>
          </a>
          <a href="javascript:void(0)" ng-scroll-to-on-click="navAnchor('Restaurant')">
            <div class="col-md-1 navigation-link">
              Restaurants
            </div>
          </a>
          <a href="javascript:void(0)" ng-scroll-to-on-click="navAnchor('Attraction')">
            <div class="col-md-1 navigation-link">
              Attractions
            </div>
          </a>
        </div>
        <div class="col-md-6" id="url-box">
          {% if allow_editing %}
          <input type="text" class="form-control"
            placeholder="Paste a URL to add to your trip plan"
            ng-model="clipState.url"
            ng-disabled="clipState.clipping"
            ng-paste="clipUrlChanged()"/>
          {% endif %}
        </div>
        <div class="col-me-3" id="list-map-btns">
          <button type="button" class="btn btn-default btn-sm nav-btn"
            ng-click="showGuideView()">
            <span class="glyphicon glyphicon-picture"></span>
          </button>
          <button type="button" class="btn btn-default btn-sm nav-btn"
            ng-click="showMapView()">
            <span class="glyphicon glyphicon-globe"></span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div ng-show="pageStateModel.inMapView()">

    <div id="entity-container">
      <div ng-repeat="entityType in planModel.ENTITY_TYPES_IN_ORDER">
        <div ng-controller="EntityTypeCtrl">
          <div ng-if="hasEntities()">
            <div class="one-entity-type">
              <a id="mapview-[[entityType]]" class="offset-anchor"></a>
              <h3 ng-click="toggleSection()" class="entity-type-header">
                <a href="javascript:void(0)">[[entityType]]s
                  <span ng-show="show" class="glyphicon glyphicon-chevron-down toggle-chevron"></span>
                  <span ng-show="!show" class="glyphicon glyphicon-chevron-up toggle-chevron"></span>
                </a>
              </h3>
              <div class="columns" ng-show="show">
                <div ng-repeat="entityModel in entityModels">
                  <div class="one-entity" ng-mouseenter="openInfowindow(entityModel.data['name'])" ng-controller="EntityCtrl">
                    <div class="one-entity-title">
                      [[entityModel.data['name'] ]]
                    </div>
                    <div ng-include="'carousel-template'">
                    </div>
                    <div class="one-entity-rating">
                      Rating: [[entityModel.data['rating'] ]]
                    </div>
                    <div class="entity-description"
                      ng-show="entityModel.hasDescription() && !editing">
                      <div style="white-space:pre">[[entityModel.data['description'] ]]</div>
                    </div>
                    <div ng-show="editing">
                      <textarea ng-model="entityModel.data['description']" class="form-control entity-description-input"></textarea>
                    </div>
                    <div class="one-entity-source">
                      From <a ng-href="[[entityModel.data['source_url'] ]]" target="_blank">[[entityModel.data['source_url'] | hostname ]]</a>
                    </div>
                    {% if allow_editing %}
                      <div class="entity-edit-controls">
                        <a href="javascript:void(0)"
                          ng-click="deleteEntity()"
                          ng-show="!editing">
                          <span class="glyphicon glyphicon-trash"></span>
                        </a>
                        <a href="javascript:void(0)"
                          ng-click="openEditEntity()"
                          ng-show="!editing">
                          <span class="glyphicon glyphicon-pencil"></span>
                        </a>
                        <button class="btn btn-save-changes" ng-click="saveEntityEdit()" ng-show="editing">Save</button>
                        <a href="javascript:void(0)" ng-click="cancelEditing()" ng-show="editing">
                          Cancel
                        </a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div ng-if="planModel.hasClippedPages()" ng-controller="ClippedPagesCtrl" class="clipped-pages-section">
        <h3 class="clipped-pages-header">Clipped Pages</h3>
        <div class="clipped-pages">
          <div>
            We didn't recognize these clips. We're adding support to these pages soon.
          </div>
          <div ng-repeat="clippedPage in planModel.data['clipped_pages']">
            <a href="javascript:void(0)"
              ng-click="openPageForClipping(clippedPage['source_url'])">
              [[clippedPage['title'] ]]
            </a>
          </div>
          <iframe ng-src="[[clippingPageUrl]]" ng-show="clippingActive" class="clipping-iframe">
          </iframe>
        </div>
      </div>
      <div ng-if="planModel.isEmpty()">
        <div class="getting-started-directions">
          <div class="welcome">
            Welcome to your New Trip Plan
          </div>
          <a href="javascript:(function(){c=document.createElement('script');c.type='text/javascript';c.src='{{bookmarklet_url}}'+'?'+Math.floor(Math.random()*99999999);document.body.appendChild(c);})();">
            <button class="btn btn-info" id="btn-bookmarklet">
              Travel Clipper
            </button>
          </a> <-- If you haven't already, drag me to your Bookmarks Bar
          <div class="step">
            Step 1
          </div>
          <p>
            Pick a travel destination then browse popular travel websites for hotel, restaurant, and attraction options
          </p>
          <div class="step">
            Step 2
          </div>
          <p>
            Clip to this Trip Plan by using the clipper or by pasting the URL of the website you want to save in the URL input above
          </p>
          <div class="step">
            Step 3
          </div>
          <p>
            Come back to this Trip Plan and your bookmarked points of interest will instantly be ready for you to browse and manage
          </p>
        </div>
      </div>

      <div class="left-footer">
        Copyright 2014 Unicycle Labs
      </div>

    </div>

    <div id="map-container">
      <div id="map">
      </div>
    </div>

  </div>  {# end map view #}

  <div ng-show="pageStateModel.inGuideView()" ng-controller="GuideViewCtrl">

    <div class="guideview-container">
      <div ng-repeat="entityType in planModel.ENTITY_TYPES_IN_ORDER">
        <div ng-controller="GuideViewEntityTypeCtrl">
          <div ng-if="hasEntities()">
            <a id="guideview-[[entityType]]" class="offset-anchor"></a>
            <div class="guideview-entity-type-header">[[entityType]]s</div>
            <div ng-repeat="entityModel in entityModels">
              <div class="guideview-one-entity" ng-controller="GuideViewEntityCtrl"
                ng-class="{'guideview-entity-even': $even, 'guideview-entity-odd': $odd}">
                <div class="guideview-one-entity-title">
                  [[entityModel.data['name'] ]]
                </div>
                <div ng-controller="GuideViewCarouselCtrl" class="guideview-imgs-showcase">
                  <div masonry="{ transitionDuration: '0.4s', gutter: 10 }">
                    <div class="masonry-brick guideview-img-masonry-brick" ng-repeat="imgUrl in activeImgUrls()">
                      <img ng-src="[[imgUrl]]" class="guideview-masonry-img"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div> {# end guide view #}

  {# This is below the map in the DOM so that it appears visually on top #}
  <ul ng-show="accountDropdownOpen" class="account-dropdown" ng-controller="AccountDropdownCtrl">
    <li class="account-dropdown-login-info">
      <div ng-show="accountInfo.loggedIn && !showLoginForm">
        <span class="logged-in-email">[[accountInfo['email'] ]]</span>
        <span class="logout-link">
          <a href="javascript:void(0)" ng-click="showLoginForm = true">Logout</a>
        </span>
      </div>
      <div ng-show="showLoginForm">
        <form role="form" ng-submit="doLogin()">
          <input type="text" class="form-control email-entry-input"
            ng-model="accountInfo['email']"
            placeholder="Enter your email address to login"/>
          <button type="submit()" class="btn btn-primary btn-login">Login</button>
        </form>
      </div>
    </li>
    <li ng-show="allTripPlansSettings">
      <div class="my-trip-plans-heading">
        My Trip Plans
      </div>
    </li>
    <li ng-repeat="tripPlanSettings in allTripPlansSettings">
      <span ng-if="tripPlanSettings['trip_plan_id_str'] == currentTripPlanSettings['trip_plan_id_str']">
        {# Use the name from the shared settings container so it will auto update 
           if the user edits it inline. #}
        [[currentTripPlanSettings['name'] ]]
      </span>
      <span ng-if="tripPlanSettings['trip_plan_id_str'] != currentTripPlanSettings['trip_plan_id_str']">
          <a href="javascript:void(0)" ng-click="loadTripPlan(tripPlanSettings['trip_plan_id_str'])">
            [[tripPlanSettings['name'] ]]
          </a>
        </span>
    </li>
    <li class="create-new-trip-dropdown-link">
      <a href="javascript:void(0)" ng-click="createNewTripPlan()">Create New Trip Plan</a>
    </li>
  </ul>

  <script type="text/ng-template" id="clipping-modal-template">
    <div class="clipping-status-modal">
      <div ng-show="clipState.clipping">
        Clipping to your trip plan...
        <div>
          <img src="/static/img/spinner.gif"/>
        </div>
      </div>
      <div ng-show="!clipState.clipping">
        <div ng-if="clipState.statusCode == 0">
          An error occurred during clipping.  Please try again.
        </div>
        <div ng-if="clipState.statusCode == 1">
          Successfully clipped "[[clipState.entity['name'] ]]""
        </div>
        <div ng-if="clipState.statusCode == 2">
          We don't recognize this website so we've saved this URL for you to clip manually.
        </div>
        <div ng-if="clipState.statusCode == 3">
          You've already clipped this page to your trip plan.
        </div>
      </div>
    </div>
  </script>

  <script type="text/ng-template" id="carousel-template">
    <div ng-controller="CarouselCtrl" class="carousel">
      <a class="left carousel-control" ng-show="hasPrevImg()" ng-click="prevImg()">
        <span class="icon-prev"></span>
      </a>
      <img ng-src="[[currentImgUrl]]" class="entity-img"/>
      <a class="right carousel-control" ng-show="hasNextImg()" ng-click="nextImg()">
        <span class="icon-next"></span>
      </a>
    </div>
  </script>

  <script>
    initApp({{plan.to_json_str()|safe}},
      {{plan.settings_json()|safe}},
      {{all_trip_plans_settings_json|safe}},
      {{account_info.to_json_str()|safe}});
  </script>
</body>
</html>
